import fs from 'node:fs/promises';
import url from 'node:url';
import path from 'node:path';
import child_process from 'node:child_process';
import { VSCODE_CAPABILITY_KEY } from './constants.js';
const __dirname = url.fileURLToPath(new URL('.', import.meta.url));
function isEmulatedRosettaEnvironment() {
    const archName = child_process.spawnSync('uname', ['-m']).stdout.toString().trim();
    if (archName !== 'x86_64') {
        return false;
    }
    const processTranslated = child_process.spawnSync('sysctl', ['-in', 'sysctl.proc_translated'])
        .stdout.toString()
        .trim();
    return processTranslated === '1';
}
function getMacOsRealArch() {
    if (process.arch === 'arm64' || isEmulatedRosettaEnvironment()) {
        return 'mac64_m1';
    }
    if (process.arch === 'x64') {
        return 'mac64';
    }
    return null;
}
export function validatePlatform() {
    if (process.platform === 'linux') {
        if (process.arch === 'arm64' || process.arch === 'x64') {
            return `${process.platform}64`;
        }
        throw new Error('Only Linux 64 bits supported.');
    }
    if (process.platform === 'darwin' || process.platform === 'freebsd') {
        const osxPlatform = getMacOsRealArch();
        if (!osxPlatform) {
            throw new Error('Only Mac 64 bits supported.');
        }
        return osxPlatform;
    }
    if (process.platform !== 'win32') {
        throw new Error(`Unexpected platform or architecture: ${process.platform}, ${process.arch}`);
    }
    return process.platform;
}
export async function getLocators(version) {
    if (version === 'insiders') {
        return import('./locators/insiders.js');
    }
    const files = (await fs.readdir(path.join(__dirname, 'locators'), { encoding: 'utf-8' }))
        .filter((filename) => filename.endsWith('.js') && !filename.endsWith('.d.ts'))
        .map((filename) => filename.slice(0, -3));
    const [major, minor] = version.split('.');
    const sanitizedVersion = `${major}.${minor}.0`;
    const locatorFile = files.find((f, i) => (f === sanitizedVersion
        || (files[i + 1] && files[i + 1] > sanitizedVersion))) || files[files.length - 1];
    return import(`./locators/${locatorFile}.js`);
}
export function fileExist(filepath) {
    return fs.access(filepath).then(() => true, () => false);
}
export async function directoryExists(directoryPath) {
    try {
        const stats = await fs.stat(directoryPath);
        return stats.isDirectory();
    }
    catch {
        return false;
    }
}
export function getValueSuffix(value) {
    if (typeof value === 'boolean' && value) {
        return '';
    }
    return `=${value}`;
}
export function isVSCodeCapability(cap) {
    return Boolean(cap[VSCODE_CAPABILITY_KEY]);
}
var FileType;
(function (FileType) {
    FileType[FileType["Unknown"] = 0] = "Unknown";
    FileType[FileType["File"] = 1] = "File";
    FileType[FileType["Directory"] = 2] = "Directory";
    FileType[FileType["SymbolicLink"] = 64] = "SymbolicLink";
})(FileType || (FileType = {}));
export function getFileType(stats) {
    if (stats.isFile()) {
        return FileType.File;
    }
    if (stats.isDirectory()) {
        return FileType.Directory;
    }
    if (stats.isSymbolicLink()) {
        return FileType.SymbolicLink;
    }
    return FileType.Unknown;
}
export const isMultiremote = (obj) => typeof obj === 'object' && !Array.isArray(obj);
export const isChrome = (cap) => cap.browserName && cap.browserName.toLowerCase() === 'chrome';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDakMsT0FBTyxHQUFHLE1BQU0sVUFBVSxDQUFBO0FBQzFCLE9BQU8sSUFBSSxNQUFNLFdBQVcsQ0FBQTtBQUM1QixPQUFPLGFBQWEsTUFBTSxvQkFBb0IsQ0FBQTtBQUc5QyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQTtBQUl0RCxNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7QUFFbEUsU0FBUyw0QkFBNEI7SUFDakMsTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUVsRixJQUFJLFFBQVEsS0FBSyxRQUFRLEVBQUU7UUFDdkIsT0FBTyxLQUFLLENBQUE7S0FDZjtJQUVELE1BQU0saUJBQWlCLEdBQUcsYUFBYSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFLLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztTQUN6RixNQUFNLENBQUMsUUFBUSxFQUFFO1NBQ2pCLElBQUksRUFBRSxDQUFBO0lBQ1gsT0FBTyxpQkFBaUIsS0FBSyxHQUFHLENBQUE7QUFDcEMsQ0FBQztBQUVELFNBQVMsZ0JBQWdCO0lBQ3JCLElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxPQUFPLElBQUksNEJBQTRCLEVBQUUsRUFBRTtRQUM1RCxPQUFPLFVBQVUsQ0FBQTtLQUNwQjtJQUVELElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxLQUFLLEVBQUU7UUFDeEIsT0FBTyxPQUFP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LFFBQVEsR0FBRyxDQUFDLEdBQXVCLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxXQUFXLElBQUksR0FBRyxDQUFDLFdBQVcsQ0FBQyxXQUFXLEVBQUUsS0FBSyxRQUFRLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSAnbm9kZTpmcy9wcm9taXNlcydcbmltcG9ydCB1cmwgZnJvbSAnbm9kZTp1cmwnXG5pbXBvcnQgcGF0aCBmcm9tICdub2RlOnBhdGgnXG5pbXBvcnQgY2hpbGRfcHJvY2VzcyBmcm9tICdub2RlOmNoaWxkX3Byb2Nlc3MnXG5pbXBvcnQgdHlwZSB7IERpcmVudCwgU3RhdHMgfSBmcm9tICdub2RlOmZzJ1xuXG5pbXBvcnQgeyBWU0NPREVfQ0FQQUJJTElUWV9LRVkgfSBmcm9tICcuL2NvbnN0YW50cy5qcydcbmltcG9ydCB0eXBlIHsgVlNDb2RlTG9jYXRvck1hcCB9IGZyb20gJy4vcGFnZW9iamVjdHMvdXRpbHMnXG5pbXBvcnQgdHlwZSB7IFZTQ29kZUNhcGFiaWxpdGllcyB9IGZyb20gJy4vdHlwZXMnXG5cbmNvbnN0IF9fZGlybmFtZSA9IHVybC5maWxlVVJMVG9QYXRoKG5ldyBVUkwoJy4nLCBpbXBvcnQubWV0YS51cmwpKVxuXG5mdW5jdGlvbiBpc0VtdWxhdGVkUm9zZXR0YUVudmlyb25tZW50ICgpIHtcbiAgICBjb25zdCBhcmNoTmFtZSA9IGNoaWxkX3Byb2Nlc3Muc3Bhd25TeW5jKCd1bmFtZScsIFsnLW0nXSkuc3Rkb3V0LnRvU3RyaW5nKCkudHJpbSgpXG5cbiAgICBpZiAoYXJjaE5hbWUgIT09ICd4ODZfNjQnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IHByb2Nlc3NUcmFuc2xhdGVkID0gY2hpbGRfcHJvY2Vzcy5zcGF3blN5bmMoJ3N5c2N0bCcsIFsnLWluJywgJ3N5c2N0bC5wcm9jX3RyYW5zbGF0ZWQnXSlcbiAgICAgICAgLnN0ZG91dC50b1N0cmluZygpXG4gICAgICAgIC50cmltKClcbiAgICByZXR1cm4gcHJvY2Vzc1RyYW5zbGF0ZWQgPT09ICcxJ1xufVxuXG5mdW5jdGlvbiBnZXRNYWNPc1JlYWxBcmNoICgpIHtcbiAgICBpZiAocHJvY2Vzcy5hcmNoID09PSAnYXJtNjQnIHx8IGlzRW11bGF0ZWRSb3NldHRhRW52aXJvbm1lbnQoKSkge1xuICAgICAgICByZXR1cm4gJ21hYzY0X20xJ1xuICAgIH1cblxuICAgIGlmIChwcm9jZXNzLmFyY2ggPT09ICd4NjQnKSB7XG4gICAgICAgIHJldHVybiAnbWFjNjQnXG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGxhdGZvcm0gKCkge1xuICAgIGlmIChwcm9jZXNzLnBsYXRmb3JtID09PSAnbGludXgnKSB7XG4gICAgICAgIGlmIChwcm9jZXNzLmFyY2ggPT09ICdhcm02NCcgfHwgcHJvY2Vzcy5hcmNoID09PSAneDY0Jykge1xuICAgICAgICAgICAgcmV0dXJuIGAke3Byb2Nlc3MucGxhdGZvcm19NjRgXG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgTGludXggNjQgYml0cyBzdXBwb3J0ZWQuJylcbiAgICB9XG5cbiAgICBpZiAocHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ2RhcndpbicgfHwgcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ2ZyZWVic2QnKSB7XG4gICAgICAgIGNvbnN0IG9zeFBsYXRmb3JtID0gZ2V0TWFjT3NSZWFsQXJjaCgpXG5cbiAgICAgICAgaWYgKCFvc3hQbGF0Zm9ybSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IE1hYyA2NCBiaXRzIHN1cHBvcnRlZC4nKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG9zeFBsYXRmb3JtXG4gICAgfVxuXG4gICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gIT09ICd3aW4zMicpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmV4cGVjdGVkIHBsYXRmb3JtIG9yIGFyY2hpdGVjdHVyZTogJHtwcm9jZXNzLnBsYXRmb3JtfSwgJHtwcm9jZXNzLmFyY2h9YClcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvY2Vzcy5wbGF0Zm9ybVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYXRvcnMgKHZlcnNpb246IHN0cmluZyk6IFByb21pc2U8VlNDb2RlTG9jYXRvck1hcD4ge1xuICAgIGlmICh2ZXJzaW9uID09PSAnaW5zaWRlcnMnKSB7XG4gICAgICAgIHJldHVybiBpbXBvcnQoJy4vbG9jYXRvcnMvaW5zaWRlcnMuanMnKSBhcyBhbnkgYXMgUHJvbWlzZTxWU0NvZGVMb2NhdG9yTWFwPlxuICAgIH1cblxuICAgIGNvbnN0IGZpbGVzID0gKGF3YWl0IGZzLnJlYWRkaXIocGF0aC5qb2luKF9fZGlybmFtZSwgJ2xvY2F0b3JzJyksIHsgZW5jb2Rpbmc6ICd1dGYtOCcgfSkpXG4gICAgICAgIC5maWx0ZXIoKGZpbGVuYW1lKSA9PiBmaWxlbmFtZS5lbmRzV2l0aCgnLmpzJykgJiYgIWZpbGVuYW1lLmVuZHNXaXRoKCcuZC50cycpKVxuICAgICAgICAubWFwKChmaWxlbmFtZSkgPT4gZmlsZW5hbWUuc2xpY2UoMCwgLTMpKVxuXG4gICAgY29uc3QgW21ham9yLCBtaW5vcl0gPSB2ZXJzaW9uLnNwbGl0KCcuJylcbiAgICBjb25zdCBzYW5pdGl6ZWRWZXJzaW9uID0gYCR7bWFqb3J9LiR7bWlub3J9LjBgXG5cbiAgICBjb25zdCBsb2NhdG9yRmlsZSA9IGZpbGVzLmZpbmQoKGYsIGkpID0+IChcbiAgICAgICAgZiA9PT0gc2FuaXRpemVkVmVyc2lvblxuICAgICAgICB8fCAoZmlsZXNbaSArIDFdICYmIGZpbGVzW2kgKyAxXSA+IHNhbml0aXplZFZlcnNpb24pXG4gICAgKSkgfHwgZmlsZXNbZmlsZXMubGVuZ3RoIC0gMV1cbiAgICByZXR1cm4gaW1wb3J0KGAuL2xvY2F0b3JzLyR7bG9jYXRvckZpbGV9LmpzYCkgYXMgUHJvbWlzZTxWU0NvZGVMb2NhdG9yTWFwPlxufVxuXG5leHBvcnQgZnVuY3Rpb24gZmlsZUV4aXN0IChmaWxlcGF0aDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGZzLmFjY2VzcyhmaWxlcGF0aCkudGhlbigoKSA9PiB0cnVlLCAoKSA9PiBmYWxzZSlcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRpcmVjdG9yeUV4aXN0cyAoZGlyZWN0b3J5UGF0aDogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBmcy5zdGF0KGRpcmVjdG9yeVBhdGgpXG4gICAgICAgIHJldHVybiBzdGF0cy5pc0RpcmVjdG9yeSgpXG4gICAgfSBjYXRjaCB7XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFZhbHVlU3VmZml4ICh2YWx1ZTogc3RyaW5nIHwgYm9vbGVhbikge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJyAmJiB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gJydcbiAgICB9XG4gICAgcmV0dXJuIGA9JHt2YWx1ZX1gXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ZTQ29kZUNhcGFiaWxpdHkgKGNhcDogVlNDb2RlQ2FwYWJpbGl0aWVzKSB7XG4gICAgcmV0dXJuIEJvb2xlYW4oY2FwW1ZTQ09ERV9DQVBBQklMSVRZX0tFWV0pXG59XG5cbmVudW0gRmlsZVR5cGUge1xuICAgIFVua25vd24gPSAwLFxuICAgIEZpbGUgPSAxLFxuICAgIERpcmVjdG9yeSA9IDIsXG4gICAgU3ltYm9saWNMaW5rID0gNjRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpbGVUeXBlIChzdGF0czogU3RhdHMgfCBEaXJlbnQpIHtcbiAgICBpZiAoc3RhdHMuaXNGaWxlKCkpIHtcbiAgICAgICAgcmV0dXJuIEZpbGVUeXBlLkZpbGVcbiAgICB9XG5cbiAgICBpZiAoc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICByZXR1cm4gRmlsZVR5cGUuRGlyZWN0b3J5XG4gICAgfVxuXG4gICAgaWYgKHN0YXRzLmlzU3ltYm9saWNMaW5rKCkpIHtcbiAgICAgICAgcmV0dXJuIEZpbGVUeXBlLlN5bWJvbGljTGlua1xuICAgIH1cblxuICAgIHJldHVybiBGaWxlVHlwZS5Vbmtub3duXG59XG5cbmV4cG9ydCBjb25zdCBpc011bHRpcmVtb3RlID0gKG9iajogYW55KSA9PiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiAhQXJyYXkuaXNBcnJheShvYmopXG5leHBvcnQgY29uc3QgaXNDaHJvbWUgPSAoY2FwOiBWU0NvZGVDYXBhYmlsaXRpZXMpID0+IGNhcC5icm93c2VyTmFtZSAmJiBjYXAuYnJvd3Nlck5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2Nocm9tZSdcbiJdfQ==