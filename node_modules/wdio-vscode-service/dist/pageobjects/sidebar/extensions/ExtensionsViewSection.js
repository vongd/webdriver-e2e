var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { Key } from 'webdriverio';
import { ViewSection } from '../ViewSection.js';
import { ExtensionsViewItem } from '../../index.js';
import { PageDecorator } from '../../utils.js';
import { ViewSection as ViewSectionLocators, ExtensionsViewSection as ExtensionsViewSectionLocators } from '../../../locators/1.73.0.js';
import { CMD_KEY } from '../../../constants.js';
/**
 * Categories of extensions to search for
 */
var ExtensionCategory;
(function (ExtensionCategory) {
    ExtensionCategory["Installed"] = "@installed";
    ExtensionCategory["Enabled"] = "@enabled";
    ExtensionCategory["Disabled"] = "@disabled";
    ExtensionCategory["Outdated"] = "@outdated";
    ExtensionCategory["Recommended"] = "@recommended";
})(ExtensionCategory || (ExtensionCategory = {}));
/**
 * View section containing extensions
 *
 * @category Sidebar
 */
let ExtensionsViewSection = class ExtensionsViewSection extends ViewSection {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = ['ViewSection', 'ExtensionsViewSection'];
    }
    async getVisibleItems() {
        await this.items$.$(this.locators.itemRow).waitForExist({
            timeoutMsg: 'Could not find any extension items'
        });
        const extensionRows = await this.items$.$$(this.locators.itemRow);
        const extensionViewItems = [];
        for (const row of extensionRows) {
            // add implicit wait to avoid stale element exceptions
            // eslint-disable-next-line wdio/no-pause
            await browser.pause(100);
            extensionViewItems.push(
            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
            await new ExtensionsViewItem(this.locatorMap, row, this).wait());
        }
        return extensionViewItems;
    }
    /**
     * Search for an extension by title. This utilizes the search bar
     * in the Extensions view, which switches the perspective to the
     * section representing the chosen category and temporarily hides all other sections.
     * If you wish to continue working with the initial view section
     * (i.e. Enabled), use the clearSearch method to reset it back to default
     *
     * @param title title to search for in '@category name' format,
     * e.g '@installed extension'. If no @category is present, marketplace will be searched
     *
     * @returns Promise resolving to ExtensionsViewItem if such item exists, undefined otherwise
     */
    async findItem(title) {
        await this.clearSearch();
        const progress = await this.content.progress$;
        const searchField = await this.content.elem.$(this.locators.searchBox);
        await searchField.addValue(title);
        await progress.waitForDisplayed();
        await progress.waitForDisplayed({ reverse: true });
        const sectionTitle = this.getSectionForCategory(title);
        const section = await this.content.getSection(sectionTitle);
        const titleParts = title.split(' ');
        if (titleParts[0].startsWith('@')) {
            title = titleParts.slice(1).join(' ');
        }
        const extensions = await section.getVisibleItems();
        for (const extension of extensions) {
            if (await extension.getTitle() === title) {
                return extension;
            }
        }
        return undefined;
    }
    /**
     * Clears the search bar on top of the view
     * @returns Promise resolving when the search box is cleared
     */
    async clearSearch() {
        const progress = await this.content.progress$;
        try {
            await browser.action('key')
                .down(CMD_KEY).down('a')
                .up(CMD_KEY).up('a')
                .perform();
            await browser.action('key')
                .down(Key.Backspace).up(Key.Backspace)
                .perform();
            await progress.waitForDisplayed();
            await progress.waitForDisplayed({ reverse: true });
        }
        catch (err) {
            // do nothing, the text field is empty
        }
    }
    /**
     * Find and open an extension item
     * @param title title of the extension
     * @returns Promise resolving when the item is clicked
     */
    async openItem(title) {
        const item = await this.findItem(title);
        if (item) {
            await item.elem.click();
        }
        return [];
    }
    getSectionForCategory(title) {
        const category = title.split(' ')[0].toLowerCase();
        switch (category) {
            case ExtensionCategory.Disabled:
                return 'Disabled';
            case ExtensionCategory.Enabled:
                return 'Enabled';
            case ExtensionCategory.Installed:
                return 'Installed';
            case ExtensionCategory.Outdated:
                return 'Outdated';
            case ExtensionCategory.Recommended:
                return 'Other Recommendations';
            default:
                return 'Marketplace';
        }
    }
};
ExtensionsViewSection = __decorate([
    PageDecorator({ ...ViewSectionLocators, ...ExtensionsViewSectionLocators })
], ExtensionsViewSection);
export { ExtensionsViewSection };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXh0ZW5zaW9uc1ZpZXdTZWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BhZ2VvYmplY3RzL3NpZGViYXIvZXh0ZW5zaW9ucy9FeHRlbnNpb25zVmlld1NlY3Rpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUVqQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sbUJBQW1CLENBQUE7QUFDL0MsT0FBTyxFQUFFLGtCQUFrQixFQUEwQixNQUFNLGdCQUFnQixDQUFBO0FBQzNFLE9BQU8sRUFBRSxhQUFhLEVBQWtCLE1BQU0sZ0JBQWdCLENBQUE7QUFDOUQsT0FBTyxFQUNILFdBQVcsSUFBSSxtQkFBbUIsRUFDbEMscUJBQXFCLElBQUksNkJBQTZCLEVBQ3pELE1BQU0sNkJBQTZCLENBQUE7QUFDcEMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHVCQUF1QixDQUFBO0FBRS9DOztHQUVHO0FBQ0gsSUFBSyxpQkFNSjtBQU5ELFdBQUssaUJBQWlCO0lBQ2xCLDZDQUF3QixDQUFBO0lBQ3hCLHlDQUFvQixDQUFBO0lBQ3BCLDJDQUFzQixDQUFBO0lBQ3RCLDJDQUFzQixDQUFBO0lBQ3RCLGlEQUE0QixDQUFBO0FBQ2hDLENBQUMsRUFOSSxpQkFBaUIsS0FBakIsaUJBQWlCLFFBTXJCO0FBR0Q7Ozs7R0FJRztBQUVJLElBQU0scUJBQXFCLEdBQTNCLE1BQU0scUJBQXNCLFNBQVEsV0FBVztJQUEvQzs7UUFDSDs7V0FFRztRQUNJLGVBQVUsR0FBRyxDQUFDLGFBQXNCLEVBQUUsdUJBQWdDLENBQUMsQ0FBQTtJQWlIbEYsQ0FBQztJQS9HRyxLQUFLLENBQUMsZUFBZTtRQUNqQixNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxDQUFDO1lBQ3BE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ICd3ZWJkcml2ZXJpbydcblxuaW1wb3J0IHsgVmlld1NlY3Rpb24gfSBmcm9tICcuLi9WaWV3U2VjdGlvbi5qcydcbmltcG9ydCB7IEV4dGVuc2lvbnNWaWV3SXRlbSwgQWxsVmlld1NlY3Rpb25Mb2NhdG9ycyB9IGZyb20gJy4uLy4uL2luZGV4LmpzJ1xuaW1wb3J0IHsgUGFnZURlY29yYXRvciwgSVBhZ2VEZWNvcmF0b3IgfSBmcm9tICcuLi8uLi91dGlscy5qcydcbmltcG9ydCB7XG4gICAgVmlld1NlY3Rpb24gYXMgVmlld1NlY3Rpb25Mb2NhdG9ycyxcbiAgICBFeHRlbnNpb25zVmlld1NlY3Rpb24gYXMgRXh0ZW5zaW9uc1ZpZXdTZWN0aW9uTG9jYXRvcnNcbn0gZnJvbSAnLi4vLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuaW1wb3J0IHsgQ01EX0tFWSB9IGZyb20gJy4uLy4uLy4uL2NvbnN0YW50cy5qcydcblxuLyoqXG4gKiBDYXRlZ29yaWVzIG9mIGV4dGVuc2lvbnMgdG8gc2VhcmNoIGZvclxuICovXG5lbnVtIEV4dGVuc2lvbkNhdGVnb3J5IHtcbiAgICBJbnN0YWxsZWQgPSAnQGluc3RhbGxlZCcsXG4gICAgRW5hYmxlZCA9ICdAZW5hYmxlZCcsXG4gICAgRGlzYWJsZWQgPSAnQGRpc2FibGVkJyxcbiAgICBPdXRkYXRlZCA9ICdAb3V0ZGF0ZWQnLFxuICAgIFJlY29tbWVuZGVkID0gJ0ByZWNvbW1lbmRlZCdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFeHRlbnNpb25zVmlld1NlY3Rpb24gZXh0ZW5kcyBJUGFnZURlY29yYXRvcjxBbGxWaWV3U2VjdGlvbkxvY2F0b3JzPiB7IH1cbi8qKlxuICogVmlldyBzZWN0aW9uIGNvbnRhaW5pbmcgZXh0ZW5zaW9uc1xuICpcbiAqIEBjYXRlZ29yeSBTaWRlYmFyXG4gKi9cbkBQYWdlRGVjb3JhdG9yKHsgLi4uVmlld1NlY3Rpb25Mb2NhdG9ycywgLi4uRXh0ZW5zaW9uc1ZpZXdTZWN0aW9uTG9jYXRvcnMgfSlcbmV4cG9ydCBjbGFzcyBFeHRlbnNpb25zVmlld1NlY3Rpb24gZXh0ZW5kcyBWaWV3U2VjdGlvbiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9IFsnVmlld1NlY3Rpb24nIGFzIGNvbnN0LCAnRXh0ZW5zaW9uc1ZpZXdTZWN0aW9uJyBhcyBjb25zdF1cblxuICAgIGFzeW5jIGdldFZpc2libGVJdGVtcyAoKTogUHJvbWlzZTxFeHRlbnNpb25zVmlld0l0ZW1bXT4ge1xuICAgICAgICBhd2FpdCB0aGlzLml0ZW1zJC4kKHRoaXMubG9jYXRvcnMuaXRlbVJvdykud2FpdEZvckV4aXN0KHtcbiAgICAgICAgICAgIHRpbWVvdXRNc2c6ICdDb3VsZCBub3QgZmluZCBhbnkgZXh0ZW5zaW9uIGl0ZW1zJ1xuICAgICAgICB9KVxuICAgICAgICBjb25zdCBleHRlbnNpb25Sb3dzID0gYXdhaXQgdGhpcy5pdGVtcyQuJCQodGhpcy5sb2NhdG9ycy5pdGVtUm93KVxuICAgICAgICBjb25zdCBleHRlbnNpb25WaWV3SXRlbXM6IEV4dGVuc2lvbnNWaWV3SXRlbVtdID0gW11cblxuICAgICAgICBmb3IgKGNvbnN0IHJvdyBvZiBleHRlbnNpb25Sb3dzKSB7XG4gICAgICAgICAgICAvLyBhZGQgaW1wbGljaXQgd2FpdCB0byBhdm9pZCBzdGFsZSBlbGVtZW50IGV4Y2VwdGlvbnNcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB3ZGlvL25vLXBhdXNlXG4gICAgICAgICAgICBhd2FpdCBicm93c2VyLnBhdXNlKDEwMClcbiAgICAgICAgICAgIGV4dGVuc2lvblZpZXdJdGVtcy5wdXNoKFxuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgICAgICAgICAgYXdhaXQgbmV3IEV4dGVuc2lvbnNWaWV3SXRlbSh0aGlzLmxvY2F0b3JNYXAsIHJvdyBhcyBhbnksIHRoaXMpLndhaXQoKVxuICAgICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGV4dGVuc2lvblZpZXdJdGVtc1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaCBmb3IgYW4gZXh0ZW5zaW9uIGJ5IHRpdGxlLiBUaGlzIHV0aWxpemVzIHRoZSBzZWFyY2ggYmFyXG4gICAgICogaW4gdGhlIEV4dGVuc2lvbnMgdmlldywgd2hpY2ggc3dpdGNoZXMgdGhlIHBlcnNwZWN0aXZlIHRvIHRoZVxuICAgICAqIHNlY3Rpb24gcmVwcmVzZW50aW5nIHRoZSBjaG9zZW4gY2F0ZWdvcnkgYW5kIHRlbXBvcmFyaWx5IGhpZGVzIGFsbCBvdGhlciBzZWN0aW9ucy5cbiAgICAgKiBJZiB5b3Ugd2lzaCB0byBjb250aW51ZSB3b3JraW5nIHdpdGggdGhlIGluaXRpYWwgdmlldyBzZWN0aW9uXG4gICAgICogKGkuZS4gRW5hYmxlZCksIHVzZSB0aGUgY2xlYXJTZWFyY2ggbWV0aG9kIHRvIHJlc2V0IGl0IGJhY2sgdG8gZGVmYXVsdFxuICAgICAqXG4gICAgICogQHBhcmFtIHRpdGxlIHRpdGxlIHRvIHNlYXJjaCBmb3IgaW4gJ0BjYXRlZ29yeSBuYW1lJyBmb3JtYXQsXG4gICAgICogZS5nICdAaW5zdGFsbGVkIGV4dGVuc2lvbicuIElmIG5vIEBjYXRlZ29yeSBpcyBwcmVzZW50LCBtYXJrZXRwbGFjZSB3aWxsIGJlIHNlYXJjaGVkXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBFeHRlbnNpb25zVmlld0l0ZW0gaWYgc3VjaCBpdGVtIGV4aXN0cywgdW5kZWZpbmVkIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGFzeW5jIGZpbmRJdGVtICh0aXRsZTogc3RyaW5nKTogUHJvbWlzZTxFeHRlbnNpb25zVmlld0l0ZW0gfCB1bmRlZmluZWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGVhclNlYXJjaCgpXG4gICAgICAgIGNvbnN0IHByb2dyZXNzID0gYXdhaXQgdGhpcy5jb250ZW50LnByb2dyZXNzJFxuICAgICAgICBjb25zdCBzZWFyY2hGaWVsZCA9IGF3YWl0IHRoaXMuY29udGVudC5lbGVtLiQodGhpcy5sb2NhdG9ycy5zZWFyY2hCb3gpXG4gICAgICAgIGF3YWl0IHNlYXJjaEZpZWxkLmFkZFZhbHVlKHRpdGxlKVxuXG4gICAgICAgIGF3YWl0IHByb2dyZXNzLndhaXRGb3JEaXNwbGF5ZWQoKVxuICAgICAgICBhd2FpdCBwcm9ncmVzcy53YWl0Rm9yRGlzcGxheWVkKHsgcmV2ZXJzZTogdHJ1ZSB9KVxuXG4gICAgICAgIGNvbnN0IHNlY3Rpb25UaXRsZSA9IHRoaXMuZ2V0U2VjdGlvbkZvckNhdGVnb3J5KHRpdGxlKVxuICAgICAgICBjb25zdCBzZWN0aW9uID0gYXdhaXQgdGhpcy5jb250ZW50LmdldFNlY3Rpb24oc2VjdGlvblRpdGxlKSBhcyBFeHRlbnNpb25zVmlld1NlY3Rpb25cblxuICAgICAgICBjb25zdCB0aXRsZVBhcnRzID0gdGl0bGUuc3BsaXQoJyAnKVxuICAgICAgICBpZiAodGl0bGVQYXJ0c1swXS5zdGFydHNXaXRoKCdAJykpIHtcbiAgICAgICAgICAgIHRpdGxlID0gdGl0bGVQYXJ0cy5zbGljZSgxKS5qb2luKCcgJylcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbnMgPSBhd2FpdCBzZWN0aW9uLmdldFZpc2libGVJdGVtcygpXG5cbiAgICAgICAgZm9yIChjb25zdCBleHRlbnNpb24gb2YgZXh0ZW5zaW9ucykge1xuICAgICAgICAgICAgaWYgKGF3YWl0IGV4dGVuc2lvbi5nZXRUaXRsZSgpID09PSB0aXRsZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBleHRlbnNpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhcnMgdGhlIHNlYXJjaCBiYXIgb24gdG9wIG9mIHRoZSB2aWV3XG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiB0aGUgc2VhcmNoIGJveCBpcyBjbGVhcmVkXG4gICAgICovXG4gICAgYXN5bmMgY2xlYXJTZWFyY2ggKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGF3YWl0IHRoaXMuY29udGVudC5wcm9ncmVzcyRcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIuYWN0aW9uKCdrZXknKVxuICAgICAgICAgICAgICAgIC5kb3duKENNRF9LRVkpLmRvd24oJ2EnKVxuICAgICAgICAgICAgICAgIC51cChDTURfS0VZKS51cCgnYScpXG4gICAgICAgICAgICAgICAgLnBlcmZvcm0oKVxuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAgICAgLmRvd24oS2V5LkJhY2tzcGFjZSkudXAoS2V5LkJhY2tzcGFjZSlcbiAgICAgICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgICAgICAgICBhd2FpdCBwcm9ncmVzcy53YWl0Rm9yRGlzcGxheWVkKClcbiAgICAgICAgICAgIGF3YWl0IHByb2dyZXNzLndhaXRGb3JEaXNwbGF5ZWQoeyByZXZlcnNlOiB0cnVlIH0pXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgLy8gZG8gbm90aGluZywgdGhlIHRleHQgZmllbGQgaXMgZW1wdHlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYW5kIG9wZW4gYW4gZXh0ZW5zaW9uIGl0ZW1cbiAgICAgKiBAcGFyYW0gdGl0bGUgdGl0bGUgb2YgdGhlIGV4dGVuc2lvblxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIGl0ZW0gaXMgY2xpY2tlZFxuICAgICAqL1xuICAgIGFzeW5jIG9wZW5JdGVtICh0aXRsZTogc3RyaW5nKTogUHJvbWlzZTxuZXZlcltdPiB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBhd2FpdCB0aGlzLmZpbmRJdGVtKHRpdGxlKVxuICAgICAgICBpZiAoaXRlbSkge1xuICAgICAgICAgICAgYXdhaXQgaXRlbS5lbGVtLmNsaWNrKClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW11cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFNlY3Rpb25Gb3JDYXRlZ29yeSAodGl0bGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IGNhdGVnb3J5ID0gdGl0bGUuc3BsaXQoJyAnKVswXS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIHN3aXRjaCAoY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgIGNhc2UgRXh0ZW5zaW9uQ2F0ZWdvcnkuRGlzYWJsZWQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdEaXNhYmxlZCdcbiAgICAgICAgICAgIGNhc2UgRXh0ZW5zaW9uQ2F0ZWdvcnkuRW5hYmxlZDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0VuYWJsZWQnXG4gICAgICAgICAgICBjYXNlIEV4dGVuc2lvbkNhdGVnb3J5Lkluc3RhbGxlZDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0luc3RhbGxlZCdcbiAgICAgICAgICAgIGNhc2UgRXh0ZW5zaW9uQ2F0ZWdvcnkuT3V0ZGF0ZWQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdPdXRkYXRlZCdcbiAgICAgICAgICAgIGNhc2UgRXh0ZW5zaW9uQ2F0ZWdvcnkuUmVjb21tZW5kZWQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdPdGhlciBSZWNvbW1lbmRhdGlvbnMnXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiAnTWFya2V0cGxhY2UnXG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=