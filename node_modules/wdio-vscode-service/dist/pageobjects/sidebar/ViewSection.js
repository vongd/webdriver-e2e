var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { ContextMenu, WelcomeContentSection } from '../index.js';
import { PageDecorator, BasePage, ElementWithContextMenu } from '../utils.js';
import { ViewSection as ViewSectionLocators } from '../../locators/1.73.0.js';
/**
 * Page object representing a collapsible content section of the side bar view
 *
 * @category Sidebar
 */
export class ViewSection extends BasePage {
    constructor(locators, panel, content) {
        super(locators, panel);
        this.content = content;
    }
    /**
     * Get the title of the section as string
     * @returns Promise resolving to section title
     */
    async getTitle() {
        return this.title$.getAttribute(this.locators.titleText);
    }
    /**
     * Expand the section if collapsed
     * @returns Promise resolving when the section is expanded
     */
    async expand() {
        if (await this.isHeaderHidden()) {
            return;
        }
        if (!await this.isExpanded()) {
            const panel = await this.header$;
            await panel.click();
            await browser.waitUntil(async () => (await panel.getAttribute(this.locators.headerExpanded) === 'true'), { timeout: 1000 });
        }
    }
    /**
     * Collapse the section if expanded
     * @returns Promise resolving when the section is collapsed
     */
    async collapse() {
        if (await this.isHeaderHidden()) {
            return;
        }
        if (await this.isExpanded()) {
            const panel = await this.header$;
            await panel.click();
            await browser.waitUntil(async () => (await panel.getAttribute(this.locators.headerExpanded) === 'false'), { timeout: 1000 });
        }
    }
    /**
     * Finds whether the section is expanded
     * @returns Promise resolving to true/false
     */
    async isExpanded() {
        const expanded = await this.header$.getAttribute(this.locators.headerExpanded);
        return expanded === 'true';
    }
    /**
     * Finds [Welcome Content](https://code.visualstudio.com/api/extension-guides/tree-view#welcome-content)
     * present in this ViewSection and returns it. If none is found, then `undefined` is returned
     *
     */
    async findWelcomeContent() {
        try {
            const res = await this.welcomeContent$;
            if (!await res.isDisplayed()) {
                return undefined;
            }
            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
            return new WelcomeContentSection(this.locatorMap, res, this);
        }
        catch (_err) {
            return undefined;
        }
    }
    /**
     * Retrieve the action buttons on the section's header
     * @returns Promise resolving to array of ViewPanelAction objects
     */
    async getActions() {
        const actions = [];
        if (!await this.isHeaderHidden()) {
            const elements = await this
                .header$
                .$(this.locators.actions)
                .$$(this.locators.button);
            for (const element of elements) {
                actions.push(await new ViewPanelAction(this.locatorMap, 
                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
                element, this).wait());
            }
        }
        return actions;
    }
    /**
     * Retrieve an action button on the sections's header by its label
     * @param label label/title of the button
     * @returns ViewPanelAction object if found, undefined otherwise
     */
    async getAction(label) {
        const actions = await this.getActions();
        for (const action of actions) {
            if (await action.getLabel() === label) {
                return action;
            }
        }
        return undefined;
    }
    /**
     * Click on the More Actions... item if it exists
     *
     * @returns ContextMenu page object if the action succeeds, undefined otherwise
     */
    async moreActions() {
        const more = await this.getAction('More Actions...');
        if (!more) {
            return undefined;
        }
        const section = this;
        const self = this;
        const btn = new class extends ElementWithContextMenu {
            constructor() {
                super(...arguments);
                this.locatorKey = 'ViewSection';
            }
            async openContextMenu() {
                await this.elem.click();
                const shadowRootHost = await section.elem.$$('.shadow-root-host');
                if (shadowRootHost.length > 0) {
                    const shadowRoot = $(await browser.execute('return arguments[0].shadowRoot', shadowRootHost[0]));
                    return new ContextMenu(self.locatorMap, shadowRoot).wait();
                }
                return super.openContextMenu();
            }
        }(this.locatorMap, more.elem, this.elem);
        return btn.openContextMenu();
    }
    async isHeaderHidden() {
        return (await this.header$.getAttribute('class')).indexOf('hidden') > -1;
    }
}
/**
 * Action button on the header of a view section
 *
 * @category Sidebar
 */
let ViewPanelAction = class ViewPanelAction extends BasePage {
    constructor(locators, element, viewPart) {
        super(locators, element, viewPart.elem);
        /**
         * @private
         */
        this.locatorKey = 'ViewSection';
    }
    /**
     * Get label of the action button
     */
    async getLabel() {
        return this.elem.getAttribute(this.locators.buttonLabel);
    }
    async wait(timeout = 1000) {
        await this.elem.waitForEnabled({ timeout });
        return this;
    }
};
ViewPanelAction = __decorate([
    PageDecorator(ViewSectionLocators)
], ViewPanelAction);
export { ViewPanelAction };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld1NlY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvc2lkZWJhci9WaWV3U2VjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxPQUFPLEVBQ0gsV0FBVyxFQUF5QixxQkFBcUIsRUFDNUQsTUFBTSxhQUFhLENBQUE7QUFDcEIsT0FBTyxFQUNILGFBQWEsRUFBa0IsUUFBUSxFQUFFLHNCQUFzQixFQUNsRSxNQUFNLGFBQWEsQ0FBQTtBQUNwQixPQUFPLEVBQ0gsV0FBVyxJQUFJLG1CQUFtQixFQUlyQyxNQUFNLDBCQUEwQixDQUFBO0FBYWpDOzs7O0dBSUc7QUFDSCxNQUFNLE9BQWdCLFdBQVksU0FBUSxRQUFnQztJQUN0RSxZQUNJLFFBQTBCLEVBQzFCLEtBQW1ELEVBQzVDLE9BQW9CO1FBRTNCLEtBQUssQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFGZixZQUFPLEdBQVAsT0FBTyxDQUFhO0lBRy9CLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLE1BQU07UUFDUixJQUFJLE1BQU0sSUFBSSxDQUFDLGNBQWMsRUFBRSxFQUFFO1lBQzdCLE9BQU07U0FDVDtRQUNELElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUMxQixNQUFNLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUE7WUFDaEMsTUFBTSxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUE7WUFDbkIsTUFBTSxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FDaEMsTUFBTSxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEtBQUssTUFBTSxDQUNwRSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7U0FDeEI7SUFDTCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLFFBQVE7UUFDVixJQUFJLE1BQU0sSUFBSSxDQUFDLGNBQWMsRUFBRSxFQUFFO1lBQzdCLE9BQU07U0FDVDtRQUNELElBQUksTUFBTSxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDekIsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFBO1lBQ2hDLE1BQU0sS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFBO1lBQ25CLE1BQU0sT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLENBQ2hDLE1BQU0sS0FBSyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxLQUFLLE9BQU8sQ0FDckUsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO1NBQ3hCO0lBQ0wsQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxVQUFVO1FBQ1osTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxDQUFBO1FBQzlFLE9BQU8sUUFBUSxLQUFLLE1BQU0sQ0FBQTtJQUM5QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNJLEtBQUssQ0FBQyxrQkFBa0I7UUFDM0IsSUFBSTtZQUNBLE1BQU0sR0FBRyxHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQTtZQUN0QyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsV0FBVyxFQUFFLEVBQUU7Z0JBQzFCLE9BQU8sU0FBUyxDQUFBO2FBQ25CO1lBQ0QsaUVBQWlFO1lBQ2pFLE9BQU8sSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQTtTQUN0RTtRQUFDLE9BQU8sSUFBSSxFQUFFO1lBQ1gsT0FBTyxTQUFTLENBQUE7U0FDbkI7SUFDTCxDQUFDO0lBb0NEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxVQUFVO1FBQ1osTUFBTSxPQUFPLEdBQXNCLEVBQUUsQ0FBQTtRQUVyQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsY0FBYyxFQUFFLEVBQUU7WUFDOUIsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJO2lCQUN0QixPQUFPO2lCQUNQLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztpQkFDeEIsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUE7WUFFN0IsS0FBSyxNQUFNLE9BQU8sSUFBSSxRQUFRLEVBQUU7Z0JBQzVCLE9BQU8sQ0FBQyxJQUFJLENBQ1IsTUFBTSxJQUFJLGVBQWUsQ0FDckIsSUFBSSxDQUFDLFVBQVU7Z0JBQ2YsaUVBQWlFO2dCQUNqRSxPQUFjLEVBQ2QsSUFBSSxDQUNQLENBQUMsSUFBSSxFQUFFLENBQ1gsQ0FBQTthQUNKO1NBQ0o7UUFDRCxPQUFPLE9BQU8sQ0FBQTtJQUNsQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILEtBQUssQ0FBQyxTQUFTLENBQUUsS0FBYTtRQUMxQixNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtRQUN2QyxLQUFLLE1BQU0sTUFBTSxJQUFJLE9BQU8sRUFBRTtZQUMxQixJQUFJLE1BQU0sTUFBTSxDQUFDLFFBQVEsRUFBRSxLQUFLLEtBQUssRUFBRTtnQkFDbkMsT0FBTyxNQUFNLENBQUE7YUFDaEI7U0FDSjtRQUNELE9BQU8sU0FBUyxDQUFBO0lBQ3BCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsS0FBSyxDQUFDLFdBQVc7UUFDYixNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtRQUNwRCxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFDRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUE7UUFDcEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFBO1FBQ2pCLE1BQU0sR0FBRyxHQUFHLElBQUksS0FBTSxTQUFRLHNCQUFrRDtZQUFoRTs7Z0JBQ1osZUFBVSxHQUFHLGFBQXNCLENBQUE7WUFXdkMsQ0FBQztZQVRHLEtBQUssQ0FBQyxlQUFlO2dCQUNqQixNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUE7Z0JBQ3ZCLE1BQU0sY0FBYyxHQUFHLE1BQU0sT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsQ0FBQTtnQkFDakUsSUFBSSxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDM0IsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDLE1BQU0sT0FBTyxDQUFDLE9BQU8sQ0FBQyxnQ0FBZ0MsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUNoRyxPQUFPLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7aUJBQzdEO2dCQUNELE9BQU8sS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFBO1lBQ2xDLENBQUM7U0FDSixDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEMsT0FBTyxHQUFHLENBQUMsZUFBZSxFQUFFLENBQUE7SUFDaEMsQ0FBQztJQUVPLEtBQUssQ0FBQyxjQUFjO1FBQ3hCLE9BQU8sQ0FBQyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBQzVFLENBQUM7Q0FDSjtBQUdEOzs7O0dBSUc7QUFFSSxJQUFNLGVBQWUsR0FBckIsTUFBTSxlQUFnQixTQUFRLFFBQW9DO0lBTXJFLFlBQ0ksUUFBMEIsRUFDMUIsT0FBcUQsRUFDckQsUUFBcUI7UUFFckIsS0FBSyxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBVjNDOztXQUVHO1FBQ0ksZUFBVSxHQUFHLGFBQXNCLENBQUE7SUFRMUMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELEtBQUssQ0FBQyxJQUFJLENBQUUsT0FBTyxHQUFHLElBQUk7UUFDdEIsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFDM0MsT0FBTyxJQUFJLENBQUE7SUFDZixDQUFDO0NBQ0osQ0FBQTtBQXpCWSxlQUFlO0lBRDNCLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQztHQUN0QixlQUFlLENBeUIzQjtTQXpCWSxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDaGFpbmFibGVQcm9taXNlRWxlbWVudCB9IGZyb20gJ3dlYmRyaXZlcmlvJ1xuXG5pbXBvcnQge1xuICAgIENvbnRleHRNZW51LCBWaWV3Q29udGVudCwgVmlld0l0ZW0sIFdlbGNvbWVDb250ZW50U2VjdGlvblxufSBmcm9tICcuLi9pbmRleC5qcydcbmltcG9ydCB7XG4gICAgUGFnZURlY29yYXRvciwgSVBhZ2VEZWNvcmF0b3IsIEJhc2VQYWdlLCBFbGVtZW50V2l0aENvbnRleHRNZW51LCBWU0NvZGVMb2NhdG9yTWFwXG59IGZyb20gJy4uL3V0aWxzLmpzJ1xuaW1wb3J0IHtcbiAgICBWaWV3U2VjdGlvbiBhcyBWaWV3U2VjdGlvbkxvY2F0b3JzLFxuICAgIEV4dGVuc2lvbnNWaWV3U2VjdGlvbiBhcyBFeHRlbnNpb25zVmlld1NlY3Rpb25Mb2NhdG9ycyxcbiAgICBDdXN0b21UcmVlU2VjdGlvbiBhcyBDdXN0b21UcmVlU2VjdGlvbkxvY2F0b3JzLFxuICAgIERlZmF1bHRUcmVlU2VjdGlvbiBhcyBEZWZhdWx0VHJlZVNlY3Rpb25Mb2NhdG9yc1xufSBmcm9tICcuLi8uLi9sb2NhdG9ycy8xLjczLjAuanMnXG5cbi8qKlxuICogQGhpZGRlblxuICovXG5leHBvcnQgdHlwZSBBbGxWaWV3U2VjdGlvbkxvY2F0b3JzID0gKFxuICAgIHR5cGVvZiBWaWV3U2VjdGlvbkxvY2F0b3JzICZcbiAgICB0eXBlb2YgRXh0ZW5zaW9uc1ZpZXdTZWN0aW9uTG9jYXRvcnMgJlxuICAgIHR5cGVvZiBDdXN0b21UcmVlU2VjdGlvbkxvY2F0b3JzICZcbiAgICB0eXBlb2YgRGVmYXVsdFRyZWVTZWN0aW9uTG9jYXRvcnNcbilcblxuZXhwb3J0IGludGVyZmFjZSBWaWV3U2VjdGlvbiBleHRlbmRzIElQYWdlRGVjb3JhdG9yPEFsbFZpZXdTZWN0aW9uTG9jYXRvcnM+IHsgfVxuLyoqXG4gKiBQYWdlIG9iamVjdCByZXByZXNlbnRpbmcgYSBjb2xsYXBzaWJsZSBjb250ZW50IHNlY3Rpb24gb2YgdGhlIHNpZGUgYmFyIHZpZXdcbiAqXG4gKiBAY2F0ZWdvcnkgU2lkZWJhclxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVmlld1NlY3Rpb24gZXh0ZW5kcyBCYXNlUGFnZTxBbGxWaWV3U2VjdGlvbkxvY2F0b3JzPiB7XG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBsb2NhdG9yczogVlNDb2RlTG9jYXRvck1hcCxcbiAgICAgICAgcGFuZWw6IENoYWluYWJsZVByb21pc2VFbGVtZW50PFdlYmRyaXZlcklPLkVsZW1lbnQ+LFxuICAgICAgICBwdWJsaWMgY29udGVudDogVmlld0NvbnRlbnRcbiAgICApIHtcbiAgICAgICAgc3VwZXIobG9jYXRvcnMsIHBhbmVsKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGl0bGUgb2YgdGhlIHNlY3Rpb24gYXMgc3RyaW5nXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gc2VjdGlvbiB0aXRsZVxuICAgICAqL1xuICAgIGFzeW5jIGdldFRpdGxlICgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gdGhpcy50aXRsZSQuZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMudGl0bGVUZXh0KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4cGFuZCB0aGUgc2VjdGlvbiBpZiBjb2xsYXBzZWRcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIHRoZSBzZWN0aW9uIGlzIGV4cGFuZGVkXG4gICAgICovXG4gICAgYXN5bmMgZXhwYW5kICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuaXNIZWFkZXJIaWRkZW4oKSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhd2FpdCB0aGlzLmlzRXhwYW5kZWQoKSkge1xuICAgICAgICAgICAgY29uc3QgcGFuZWwgPSBhd2FpdCB0aGlzLmhlYWRlciRcbiAgICAgICAgICAgIGF3YWl0IHBhbmVsLmNsaWNrKClcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIud2FpdFVudGlsKGFzeW5jICgpID0+IChcbiAgICAgICAgICAgICAgICBhd2FpdCBwYW5lbC5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9ycy5oZWFkZXJFeHBhbmRlZCkgPT09ICd0cnVlJ1xuICAgICAgICAgICAgKSwgeyB0aW1lb3V0OiAxMDAwIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb2xsYXBzZSB0aGUgc2VjdGlvbiBpZiBleHBhbmRlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIHNlY3Rpb24gaXMgY29sbGFwc2VkXG4gICAgICovXG4gICAgYXN5bmMgY29sbGFwc2UgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0hlYWRlckhpZGRlbigpKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0V4cGFuZGVkKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhbmVsID0gYXdhaXQgdGhpcy5oZWFkZXIkXG4gICAgICAgICAgICBhd2FpdCBwYW5lbC5jbGljaygpXG4gICAgICAgICAgICBhd2FpdCBicm93c2VyLndhaXRVbnRpbChhc3luYyAoKSA9PiAoXG4gICAgICAgICAgICAgICAgYXdhaXQgcGFuZWwuZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMuaGVhZGVyRXhwYW5kZWQpID09PSAnZmFsc2UnXG4gICAgICAgICAgICApLCB7IHRpbWVvdXQ6IDEwMDAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmRzIHdoZXRoZXIgdGhlIHNlY3Rpb24gaXMgZXhwYW5kZWRcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byB0cnVlL2ZhbHNlXG4gICAgICovXG4gICAgYXN5bmMgaXNFeHBhbmRlZCAoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGNvbnN0IGV4cGFuZGVkID0gYXdhaXQgdGhpcy5oZWFkZXIkLmdldEF0dHJpYnV0ZSh0aGlzLmxvY2F0b3JzLmhlYWRlckV4cGFuZGVkKVxuICAgICAgICByZXR1cm4gZXhwYW5kZWQgPT09ICd0cnVlJ1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmRzIFtXZWxjb21lIENvbnRlbnRdKGh0dHBzOi8vY29kZS52aXN1YWxzdHVkaW8uY29tL2FwaS9leHRlbnNpb24tZ3VpZGVzL3RyZWUtdmlldyN3ZWxjb21lLWNvbnRlbnQpXG4gICAgICogcHJlc2VudCBpbiB0aGlzIFZpZXdTZWN0aW9uIGFuZCByZXR1cm5zIGl0LiBJZiBub25lIGlzIGZvdW5kLCB0aGVuIGB1bmRlZmluZWRgIGlzIHJldHVybmVkXG4gICAgICpcbiAgICAgKi9cbiAgICBwdWJsaWMgYXN5bmMgZmluZFdlbGNvbWVDb250ZW50ICgpOiBQcm9taXNlPFdlbGNvbWVDb250ZW50U2VjdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy53ZWxjb21lQ29udGVudCRcbiAgICAgICAgICAgIGlmICghYXdhaXQgcmVzLmlzRGlzcGxheWVkKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hcmd1bWVudFxuICAgICAgICAgICAgcmV0dXJuIG5ldyBXZWxjb21lQ29udGVudFNlY3Rpb24odGhpcy5sb2NhdG9yTWFwLCByZXMgYXMgYW55LCB0aGlzKVxuICAgICAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBhbGwgaXRlbXMgY3VycmVudGx5IHZpc2libGUgaW4gdGhlIHZpZXcgc2VjdGlvbi5cbiAgICAgKiBOb3RlIHRoYXQgYW55IGl0ZW0gY3VycmVudGx5IGJleW9uZCB0aGUgdmlzaWJsZSBsaXN0LCBpLmUuIG5vdCBzY3JvbGxlZCB0bywgd2lsbCBub3QgYmUgcmV0cmlldmVkLlxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGFycmF5IG9mIFZpZXdJdGVtIG9iamVjdHNcbiAgICAgKi9cbiAgICBhYnN0cmFjdCBnZXRWaXNpYmxlSXRlbXMgKCk6IFByb21pc2U8Vmlld0l0ZW1bXT5cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYW4gaXRlbSBpbiB0aGlzIHZpZXcgc2VjdGlvbiBieSBsYWJlbC4gRG9lcyBub3QgcGVyZm9ybSByZWN1cnNpdmUgc2VhcmNoIHRocm91Z2ggdGhlIHdob2xlIHRyZWUuXG4gICAgICogRG9lcyBob3dldmVyIHNjcm9sbCB0aHJvdWdoIGFsbCB0aGUgZXhwYW5kZWQgY29udGVudC4gV2lsbCBmaW5kIGl0ZW1zIGJleW9uZCB0aGUgY3VycmVudCBzY3JvbGwgcmFuZ2UuXG4gICAgICogQHBhcmFtIGxhYmVsIExhYmVsIG9mIHRoZSBpdGVtIHRvIHNlYXJjaCBmb3IuXG4gICAgICogQHBhcmFtIG1heExldmVsIExpbWl0IGhvdyBkZWVwIHRoZSBhbGdvcml0aG0gc2hvdWxkIGxvb2sgaW50byBhbnkgZXhwYW5kZWQgaXRlbXMsIGRlZmF1bHQgdW5saW1pdGVkICgwKVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIFZpZXdJdGVtIG9iamVjdCBpcyBzdWNoIGl0ZW0gZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYWJzdHJhY3QgZmluZEl0ZW0gKGxhYmVsOiBzdHJpbmcsIG1heExldmVsPzogbnVtYmVyKTogUHJvbWlzZTxWaWV3SXRlbSB8IHVuZGVmaW5lZD5cblxuICAgIC8qKlxuICAgICAqIE9wZW4gYW4gaXRlbSB3aXRoIGEgZ2l2ZW4gcGF0aCByZXByZXNlbnRlZCBieSBhIHNlcXVlbmNlIG9mIGxhYmVsc1xuICAgICAqXG4gICAgICogZS5nIHRvIG9wZW4gJ2ZpbGUnIGluc2lkZSAnZm9sZGVyJywgY2FsbFxuICAgICAqIG9wZW5JdGVtKCdmb2xkZXInLCAnZmlsZScpXG4gICAgICpcbiAgICAgKiBUaGUgZmlyc3QgaXRlbSBpcyBvbmx5IHNlYXJjaGVkIGZvciBkaXJlY3RseSB3aXRoaW4gdGhlIHJvb3QgZWxlbWVudCAoZGVwdGggMSkuXG4gICAgICogVGhlIGxhYmVsIHNlcXVlbmNlIGlzIGhhbmRsZWQgaW4gb3JkZXIuIElmIGEgbGVhZiBpdGVtIChhIGZpbGUgZm9yIGV4YW1wbGUpIGlzIGZvdW5kIGluIHRoZSBtaWRkbGVcbiAgICAgKiBvZiB0aGUgc2VxdWVuY2UsIHRoZSByZXN0IGlzIGlnbm9yZWQuXG4gICAgICpcbiAgICAgKiBJZiB0aGUgaXRlbSBzdHJ1Y3R1cmUgaXMgZmxhdCwgdXNlIHRoZSBpdGVtJ3MgdGl0bGUgdG8gc2VhcmNoIGJ5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGggU2VxdWVuY2Ugb2YgbGFiZWxzIHRoYXQgbWFrZSB1cCB0aGUgcGF0aCB0byBhIGdpdmVuIGl0ZW0uXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYXJyYXkgb2YgVmlld0l0ZW0gb2JqZWN0cyByZXByZXNlbnRpbmcgdGhlIGxhc3QgaXRlbSdzIGNoaWxkcmVuLlxuICAgICAqIElmIHRoZSBsYXN0IGl0ZW0gaXMgYSBsZWFmLCBlbXB0eSBhcnJheSBpcyByZXR1cm5lZC5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBvcGVuSXRlbSAoLi4ucGF0aDogc3RyaW5nW10pOiBQcm9taXNlPFZpZXdJdGVtW10+XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSB0aGUgYWN0aW9uIGJ1dHRvbnMgb24gdGhlIHNlY3Rpb24ncyBoZWFkZXJcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBhcnJheSBvZiBWaWV3UGFuZWxBY3Rpb24gb2JqZWN0c1xuICAgICAqL1xuICAgIGFzeW5jIGdldEFjdGlvbnMgKCk6IFByb21pc2U8Vmlld1BhbmVsQWN0aW9uW10+IHtcbiAgICAgICAgY29uc3QgYWN0aW9uczogVmlld1BhbmVsQWN0aW9uW10gPSBbXVxuXG4gICAgICAgIGlmICghYXdhaXQgdGhpcy5pc0hlYWRlckhpZGRlbigpKSB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50cyA9IGF3YWl0IHRoaXNcbiAgICAgICAgICAgICAgICAuaGVhZGVyJFxuICAgICAgICAgICAgICAgIC4kKHRoaXMubG9jYXRvcnMuYWN0aW9ucylcbiAgICAgICAgICAgICAgICAuJCQodGhpcy5sb2NhdG9ycy5idXR0b24pXG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgICAgICAgICAgICAgIGFjdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFZpZXdQYW5lbEFjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9jYXRvck1hcCxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50IGFzIGFueSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgICAgICAgKS53YWl0KClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjdGlvbnNcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZSBhbiBhY3Rpb24gYnV0dG9uIG9uIHRoZSBzZWN0aW9ucydzIGhlYWRlciBieSBpdHMgbGFiZWxcbiAgICAgKiBAcGFyYW0gbGFiZWwgbGFiZWwvdGl0bGUgb2YgdGhlIGJ1dHRvblxuICAgICAqIEByZXR1cm5zIFZpZXdQYW5lbEFjdGlvbiBvYmplY3QgaWYgZm91bmQsIHVuZGVmaW5lZCBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBhc3luYyBnZXRBY3Rpb24gKGxhYmVsOiBzdHJpbmcpOiBQcm9taXNlPFZpZXdQYW5lbEFjdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gYXdhaXQgdGhpcy5nZXRBY3Rpb25zKClcbiAgICAgICAgZm9yIChjb25zdCBhY3Rpb24gb2YgYWN0aW9ucykge1xuICAgICAgICAgICAgaWYgKGF3YWl0IGFjdGlvbi5nZXRMYWJlbCgpID09PSBsYWJlbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xpY2sgb24gdGhlIE1vcmUgQWN0aW9ucy4uLiBpdGVtIGlmIGl0IGV4aXN0c1xuICAgICAqXG4gICAgICogQHJldHVybnMgQ29udGV4dE1lbnUgcGFnZSBvYmplY3QgaWYgdGhlIGFjdGlvbiBzdWNjZWVkcywgdW5kZWZpbmVkIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGFzeW5jIG1vcmVBY3Rpb25zICgpOiBQcm9taXNlPENvbnRleHRNZW51IHwgdW5kZWZpbmVkPiB7XG4gICAgICAgIGNvbnN0IG1vcmUgPSBhd2FpdCB0aGlzLmdldEFjdGlvbignTW9yZSBBY3Rpb25zLi4uJylcbiAgICAgICAgaWYgKCFtb3JlKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VjdGlvbiA9IHRoaXNcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXNcbiAgICAgICAgY29uc3QgYnRuID0gbmV3IGNsYXNzIGV4dGVuZHMgRWxlbWVudFdpdGhDb250ZXh0TWVudTx0eXBlb2YgVmlld1NlY3Rpb25Mb2NhdG9ycz4ge1xuICAgICAgICAgICAgbG9jYXRvcktleSA9ICdWaWV3U2VjdGlvbicgYXMgY29uc3RcblxuICAgICAgICAgICAgYXN5bmMgb3BlbkNvbnRleHRNZW51ICgpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmVsZW0uY2xpY2soKVxuICAgICAgICAgICAgICAgIGNvbnN0IHNoYWRvd1Jvb3RIb3N0ID0gYXdhaXQgc2VjdGlvbi5lbGVtLiQkKCcuc2hhZG93LXJvb3QtaG9zdCcpXG4gICAgICAgICAgICAgICAgaWYgKHNoYWRvd1Jvb3RIb3N0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hhZG93Um9vdCA9ICQoYXdhaXQgYnJvd3Nlci5leGVjdXRlKCdyZXR1cm4gYXJndW1lbnRzWzBdLnNoYWRvd1Jvb3QnLCBzaGFkb3dSb290SG9zdFswXSkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29udGV4dE1lbnUoc2VsZi5sb2NhdG9yTWFwLCBzaGFkb3dSb290KS53YWl0KClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm9wZW5Db250ZXh0TWVudSgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0odGhpcy5sb2NhdG9yTWFwLCBtb3JlLmVsZW0sIHRoaXMuZWxlbSlcbiAgICAgICAgcmV0dXJuIGJ0bi5vcGVuQ29udGV4dE1lbnUoKVxuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgaXNIZWFkZXJIaWRkZW4gKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gKGF3YWl0IHRoaXMuaGVhZGVyJC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykpLmluZGV4T2YoJ2hpZGRlbicpID4gLTFcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmlld1BhbmVsQWN0aW9uIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFZpZXdTZWN0aW9uTG9jYXRvcnM+IHsgfVxuLyoqXG4gKiBBY3Rpb24gYnV0dG9uIG9uIHRoZSBoZWFkZXIgb2YgYSB2aWV3IHNlY3Rpb25cbiAqXG4gKiBAY2F0ZWdvcnkgU2lkZWJhclxuICovXG5AUGFnZURlY29yYXRvcihWaWV3U2VjdGlvbkxvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIFZpZXdQYW5lbEFjdGlvbiBleHRlbmRzIEJhc2VQYWdlPHR5cGVvZiBWaWV3U2VjdGlvbkxvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdWaWV3U2VjdGlvbicgYXMgY29uc3RcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIGVsZW1lbnQ6IENoYWluYWJsZVByb21pc2VFbGVtZW50PFdlYmRyaXZlcklPLkVsZW1lbnQ+LFxuICAgICAgICB2aWV3UGFydDogVmlld1NlY3Rpb25cbiAgICApIHtcbiAgICAgICAgc3VwZXIobG9jYXRvcnMsIGVsZW1lbnQsIHZpZXdQYXJ0LmVsZW0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGxhYmVsIG9mIHRoZSBhY3Rpb24gYnV0dG9uXG4gICAgICovXG4gICAgYXN5bmMgZ2V0TGFiZWwgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW0uZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMuYnV0dG9uTGFiZWwpXG4gICAgfVxuXG4gICAgYXN5bmMgd2FpdCAodGltZW91dCA9IDEwMDApOiBQcm9taXNlPHRoaXM+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbGVtLndhaXRGb3JFbmFibGVkKHsgdGltZW91dCB9KVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH1cbn1cbiJdfQ==