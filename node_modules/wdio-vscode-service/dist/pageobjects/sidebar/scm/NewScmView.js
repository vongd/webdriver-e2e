var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { Key } from 'webdriverio';
import { ScmView, ScmProvider, MoreAction, ScmChange } from './ScmView.js';
import { PageDecorator, ElementWithContextMenu } from '../../utils.js';
import { ScmView as ScmViewLocators } from '../../../locators/1.73.0.js';
import { CMD_KEY } from '../../../constants.js';
/**
 * New SCM view for code 1.47 onwards
 *
 * @category Sidebar
 */
let NewScmView = class NewScmView extends ScmView {
    async getProviders() {
        const inputs = await this.inputField$$;
        if (inputs.length < 1) {
            return [];
        }
        const providers = await this.multiScmProvider$$;
        if (inputs.length === 1 && providers.length < 1) {
            return [await new SingleScmProvider(this.locatorMap, this.singleScmProvider$, this).wait()];
        }
        const elements = await this.multiProviderItem$$;
        return Promise.all(elements.map(async (element) => (
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        new MultiScmProvider(this.locatorMap, element, this).wait())));
    }
};
NewScmView = __decorate([
    PageDecorator(ScmViewLocators)
], NewScmView);
export { NewScmView };
/**
 * Implementation for a single SCM provider
 *
 * @category Sidebar
 */
let SingleScmProvider = class SingleScmProvider extends ScmProvider {
    /**
     * There is no title available for a single provider
     */
    getTitle() {
        return Promise.resolve('');
    }
    /**
     * No title available for single provider
     */
    getType() {
        return Promise.resolve('');
    }
    async takeAction(title) {
        const view = this.view;
        const buttons = await view.getTitlePart().getActions();
        const names = await Promise.all(buttons.map((button) => button.getTitle()));
        const index = names.findIndex((name) => name === title);
        if (index > -1) {
            await buttons[index].elem.click();
            return true;
        }
        return false;
    }
    async openMoreActions() {
        const view = this.view;
        return new MoreAction(this.locatorMap, view).openContextMenu();
    }
    async getChanges(staged = false) {
        const count = await this.getChangeCount(staged);
        const elements = [];
        if (count > 0) {
            const header = staged
                ? await this.stagedChanges$
                : await this.changes$;
            const startIndex = +await header.getAttribute('data-index');
            const depth = +await header.getAttribute('aria-level') + 1;
            const items = await this.itemLevel$$(depth);
            for (const item of items) {
                const index = +await item.getAttribute('data-index');
                if (index > startIndex && index <= startIndex + count) {
                    elements.push(item);
                }
            }
        }
        return Promise.all(elements.map(async (element) => (
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        new ScmChange(this.locatorMap, element, this).wait())));
    }
};
SingleScmProvider = __decorate([
    PageDecorator(ScmViewLocators)
], SingleScmProvider);
export { SingleScmProvider };
/**
 * Implementation of an SCM provider when multiple providers are available
 *
 * @category Sidebar
 */
let MultiScmProvider = class MultiScmProvider extends ScmProvider {
    async takeAction(title) {
        const actions = await this.action$$;
        const names = await Promise.all(actions.map(async (action) => action.getAttribute('title')));
        const index = names.findIndex((item) => item === title);
        if (index > -1) {
            await actions[index].click();
            return true;
        }
        return false;
    }
    async openMoreActions() {
        return new MultiMoreAction(this.locatorMap, this).openContextMenu();
    }
    async commitChanges(message) {
        const index = +await this.elem.getAttribute('data-index') + 1;
        const input = await this.view.itemIndex$(index);
        await input.clearValue();
        await input.addValue(message);
        await browser.action('key')
            .down(CMD_KEY).down(Key.Enter)
            .up(CMD_KEY).up(Key.Enter)
            .perform();
    }
    async getChanges(staged = false) {
        const count = await this.getChangeCount(staged);
        const elements = [];
        if (count > 0) {
            const index = +await this.elem.getAttribute('data-index');
            const headers = staged
                ? await this.stagedChanges$$
                : await this.changes$$;
            let header;
            for (const item of headers) {
                if (+await item.getAttribute('data-index') > index) {
                    header = item;
                }
            }
            if (!header) {
                return [];
            }
            const startIndex = +await header.getAttribute('data-index');
            const depth = +await header.getAttribute('aria-level') + 1;
            const items = await this.view.itemLevel$$(depth);
            for (const item of items) {
                const indexInner = +await item.getAttribute('data-index');
                if (indexInner > startIndex && indexInner <= startIndex + count) {
                    elements.push(item);
                }
            }
        }
        return Promise.all(elements.map(async (element) => (
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        new ScmChange(this.locatorMap, element, this).wait())));
    }
    async getChangeCount(staged = false) {
        const locator = staged ? this.locators.stagedChanges : this.locators.changes;
        const rows = await this.view.elem.$$(locator);
        const index = +await this.elem.getAttribute('data-index');
        for (const row of rows) {
            if (+await row.getAttribute('data-index') > index) {
                const count = await rows[0].$(this.locators.changeCount);
                return +await count.getText();
            }
        }
        return 0;
    }
};
MultiScmProvider = __decorate([
    PageDecorator(ScmViewLocators)
], MultiScmProvider);
export { MultiScmProvider };
/**
 * Multi More Action
 *
 * @category Sidebar
 */
let MultiMoreAction = class MultiMoreAction extends ElementWithContextMenu {
    constructor(locators, scm) {
        super(locators, locators.ScmView.multiMore, scm.elem);
        this.scm = scm;
        /**
         * @private
         */
        this.locatorKey = 'ScmView';
    }
};
MultiMoreAction = __decorate([
    PageDecorator(ScmViewLocators)
], MultiMoreAction);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTmV3U2NtVmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wYWdlb2JqZWN0cy9zaWRlYmFyL3NjbS9OZXdTY21WaWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxhQUFhLENBQUE7QUFDakMsT0FBTyxFQUNILE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFDOUMsTUFBTSxjQUFjLENBQUE7QUFFckIsT0FBTyxFQUNILGFBQWEsRUFBa0Isc0JBQXNCLEVBQ3hELE1BQU0sZ0JBQWdCLENBQUE7QUFDdkIsT0FBTyxFQUFFLE9BQU8sSUFBSSxlQUFlLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQTtBQUN4RSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFHL0M7Ozs7R0FJRztBQUVJLElBQU0sVUFBVSxHQUFoQixNQUFNLFVBQVcsU0FBUSxPQUFPO0lBQ25DLEtBQUssQ0FBQyxZQUFZO1FBQ2QsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsWUFBWSxDQUFBO1FBQ3RDLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbkIsT0FBTyxFQUFFLENBQUE7U0FDWjtRQUVELE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFBO1FBQy9DLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDN0MsT0FBTyxDQUFDLE1BQU0sSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1NBQzlGO1FBRUQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsbUJBQW1CLENBQUE7UUFDL0MsT0FBTyxP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bXBvcnQgeyBLZXkgfSBmcm9tICd3ZWJkcml2ZXJpbydcbmltcG9ydCB7XG4gICAgU2NtVmlldywgU2NtUHJvdmlkZXIsIE1vcmVBY3Rpb24sIFNjbUNoYW5nZVxufSBmcm9tICcuL1NjbVZpZXcuanMnXG5pbXBvcnQgeyBDb250ZXh0TWVudSB9IGZyb20gJy4uLy4uL2luZGV4LmpzJ1xuaW1wb3J0IHtcbiAgICBQYWdlRGVjb3JhdG9yLCBJUGFnZURlY29yYXRvciwgRWxlbWVudFdpdGhDb250ZXh0TWVudSwgVlNDb2RlTG9jYXRvck1hcFxufSBmcm9tICcuLi8uLi91dGlscy5qcydcbmltcG9ydCB7IFNjbVZpZXcgYXMgU2NtVmlld0xvY2F0b3JzIH0gZnJvbSAnLi4vLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuaW1wb3J0IHsgQ01EX0tFWSB9IGZyb20gJy4uLy4uLy4uL2NvbnN0YW50cy5qcydcblxuZXhwb3J0IGludGVyZmFjZSBOZXdTY21WaWV3IGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFNjbVZpZXdMb2NhdG9ycz4geyB9XG4vKipcbiAqIE5ldyBTQ00gdmlldyBmb3IgY29kZSAxLjQ3IG9ud2FyZHNcbiAqXG4gKiBAY2F0ZWdvcnkgU2lkZWJhclxuICovXG5AUGFnZURlY29yYXRvcihTY21WaWV3TG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgTmV3U2NtVmlldyBleHRlbmRzIFNjbVZpZXcge1xuICAgIGFzeW5jIGdldFByb3ZpZGVycyAoKTogUHJvbWlzZTxTY21Qcm92aWRlcltdPiB7XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IGF3YWl0IHRoaXMuaW5wdXRGaWVsZCQkXG4gICAgICAgIGlmIChpbnB1dHMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwcm92aWRlcnMgPSBhd2FpdCB0aGlzLm11bHRpU2NtUHJvdmlkZXIkJFxuICAgICAgICBpZiAoaW5wdXRzLmxlbmd0aCA9PT0gMSAmJiBwcm92aWRlcnMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgcmV0dXJuIFthd2FpdCBuZXcgU2luZ2xlU2NtUHJvdmlkZXIodGhpcy5sb2NhdG9yTWFwLCB0aGlzLnNpbmdsZVNjbVByb3ZpZGVyJCwgdGhpcykud2FpdCgpXVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBhd2FpdCB0aGlzLm11bHRpUHJvdmlkZXJJdGVtJCRcbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFxuICAgICAgICAgICAgZWxlbWVudHMubWFwKGFzeW5jIChlbGVtZW50KSA9PiAoXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgICAgICAgICBuZXcgTXVsdGlTY21Qcm92aWRlcih0aGlzLmxvY2F0b3JNYXAsIGVsZW1lbnQgYXMgYW55LCB0aGlzKS53YWl0KClcbiAgICAgICAgICAgICkpXG4gICAgICAgIClcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2luZ2xlU2NtUHJvdmlkZXIgZXh0ZW5kcyBJUGFnZURlY29yYXRvcjx0eXBlb2YgU2NtVmlld0xvY2F0b3JzPiB7IH1cbi8qKlxuICogSW1wbGVtZW50YXRpb24gZm9yIGEgc2luZ2xlIFNDTSBwcm92aWRlclxuICpcbiAqIEBjYXRlZ29yeSBTaWRlYmFyXG4gKi9cbkBQYWdlRGVjb3JhdG9yKFNjbVZpZXdMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBTaW5nbGVTY21Qcm92aWRlciBleHRlbmRzIFNjbVByb3ZpZGVyIHtcbiAgICAvKipcbiAgICAgKiBUaGVyZSBpcyBubyB0aXRsZSBhdmFpbGFibGUgZm9yIGEgc2luZ2xlIHByb3ZpZGVyXG4gICAgICovXG4gICAgZ2V0VGl0bGUgKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCcnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE5vIHRpdGxlIGF2YWlsYWJsZSBmb3Igc2luZ2xlIHByb3ZpZGVyXG4gICAgICovXG4gICAgZ2V0VHlwZSAoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoJycpXG4gICAgfVxuXG4gICAgYXN5bmMgdGFrZUFjdGlvbiAodGl0bGU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy52aWV3IGFzIE5ld1NjbVZpZXdcbiAgICAgICAgY29uc3QgYnV0dG9ucyA9IGF3YWl0IHZpZXcuZ2V0VGl0bGVQYXJ0KCkuZ2V0QWN0aW9ucygpXG4gICAgICAgIGNvbnN0IG5hbWVzID0gYXdhaXQgUHJvbWlzZS5hbGwoYnV0dG9ucy5tYXAoKGJ1dHRvbikgPT4gYnV0dG9uLmdldFRpdGxlKCkpKVxuXG4gICAgICAgIGNvbnN0IGluZGV4ID0gbmFtZXMuZmluZEluZGV4KChuYW1lKSA9PiBuYW1lID09PSB0aXRsZSlcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIGF3YWl0IGJ1dHRvbnNbaW5kZXhdLmVsZW0uY2xpY2soKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBhc3luYyBvcGVuTW9yZUFjdGlvbnMgKCk6IFByb21pc2U8Q29udGV4dE1lbnU+IHtcbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMudmlldyBhcyBOZXdTY21WaWV3XG4gICAgICAgIHJldHVybiBuZXcgTW9yZUFjdGlvbih0aGlzLmxvY2F0b3JNYXAsIHZpZXcpLm9wZW5Db250ZXh0TWVudSgpXG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Q2hhbmdlcyAoc3RhZ2VkID0gZmFsc2UpOiBQcm9taXNlPFNjbUNoYW5nZVtdPiB7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdGhpcy5nZXRDaGFuZ2VDb3VudChzdGFnZWQpXG4gICAgICAgIGNvbnN0IGVsZW1lbnRzOiBXZWJkcml2ZXJJTy5FbGVtZW50W10gPSBbXVxuXG4gICAgICAgIGlmIChjb3VudCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlciA9IHN0YWdlZFxuICAgICAgICAgICAgICAgID8gYXdhaXQgdGhpcy5zdGFnZWRDaGFuZ2VzJFxuICAgICAgICAgICAgICAgIDogYXdhaXQgdGhpcy5jaGFuZ2VzJFxuICAgICAgICAgICAgY29uc3Qgc3RhcnRJbmRleCA9ICthd2FpdCBoZWFkZXIuZ2V0QXR0cmlidXRlKCdkYXRhLWluZGV4JylcbiAgICAgICAgICAgIGNvbnN0IGRlcHRoID0gK2F3YWl0IGhlYWRlci5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGV2ZWwnKSArIDFcblxuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCB0aGlzLml0ZW1MZXZlbCQkKGRlcHRoKVxuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSArYXdhaXQgaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKVxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IHN0YXJ0SW5kZXggJiYgaW5kZXggPD0gc3RhcnRJbmRleCArIGNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goaXRlbSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFxuICAgICAgICAgICAgZWxlbWVudHMubWFwKGFzeW5jIChlbGVtZW50KSA9PiAoXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgICAgICAgICBuZXcgU2NtQ2hhbmdlKHRoaXMubG9jYXRvck1hcCwgZWxlbWVudCBhcyBhbnksIHRoaXMpLndhaXQoKVxuICAgICAgICAgICAgKSlcbiAgICAgICAgKVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBNdWx0aVNjbVByb3ZpZGVyIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFNjbVZpZXdMb2NhdG9ycz4geyB9XG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIGFuIFNDTSBwcm92aWRlciB3aGVuIG11bHRpcGxlIHByb3ZpZGVycyBhcmUgYXZhaWxhYmxlXG4gKlxuICogQGNhdGVnb3J5IFNpZGViYXJcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoU2NtVmlld0xvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIE11bHRpU2NtUHJvdmlkZXIgZXh0ZW5kcyBTY21Qcm92aWRlciB7XG4gICAgYXN5bmMgdGFrZUFjdGlvbiAodGl0bGU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gYXdhaXQgdGhpcy5hY3Rpb24kJFxuICAgICAgICBjb25zdCBuYW1lcyA9IGF3YWl0IFByb21pc2UuYWxsKGFjdGlvbnMubWFwKGFzeW5jIChhY3Rpb24pID0+IGFjdGlvbi5nZXRBdHRyaWJ1dGUoJ3RpdGxlJykpKVxuICAgICAgICBjb25zdCBpbmRleCA9IG5hbWVzLmZpbmRJbmRleCgoaXRlbSkgPT4gaXRlbSA9PT0gdGl0bGUpXG5cbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgIGF3YWl0IGFjdGlvbnNbaW5kZXhdLmNsaWNrKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgYXN5bmMgb3Blbk1vcmVBY3Rpb25zICgpOiBQcm9taXNlPENvbnRleHRNZW51PiB7XG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlNb3JlQWN0aW9uKHRoaXMubG9jYXRvck1hcCwgdGhpcykub3BlbkNvbnRleHRNZW51KClcbiAgICB9XG5cbiAgICBhc3luYyBjb21taXRDaGFuZ2VzIChtZXNzYWdlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgaW5kZXggPSArYXdhaXQgdGhpcy5lbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcpICsgMVxuICAgICAgICBjb25zdCBpbnB1dCA9IGF3YWl0IHRoaXMudmlldy5pdGVtSW5kZXgkKGluZGV4KVxuICAgICAgICBhd2FpdCBpbnB1dC5jbGVhclZhbHVlKClcbiAgICAgICAgYXdhaXQgaW5wdXQuYWRkVmFsdWUobWVzc2FnZSlcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpXG4gICAgICAgICAgICAuZG93bihDTURfS0VZKS5kb3duKEtleS5FbnRlcilcbiAgICAgICAgICAgIC51cChDTURfS0VZKS51cChLZXkuRW50ZXIpXG4gICAgICAgICAgICAucGVyZm9ybSgpXG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Q2hhbmdlcyAoc3RhZ2VkID0gZmFsc2UpOiBQcm9taXNlPFNjbUNoYW5nZVtdPiB7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdGhpcy5nZXRDaGFuZ2VDb3VudChzdGFnZWQpXG4gICAgICAgIGNvbnN0IGVsZW1lbnRzOiBXZWJkcml2ZXJJTy5FbGVtZW50W10gPSBbXVxuXG4gICAgICAgIGlmIChjb3VudCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gK2F3YWl0IHRoaXMuZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKVxuICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHN0YWdlZFxuICAgICAgICAgICAgICAgID8gYXdhaXQgdGhpcy5zdGFnZWRDaGFuZ2VzJCRcbiAgICAgICAgICAgICAgICA6IGF3YWl0IHRoaXMuY2hhbmdlcyQkXG4gICAgICAgICAgICBsZXQgaGVhZGVyITogV2ViZHJpdmVySU8uRWxlbWVudFxuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaGVhZGVycykge1xuICAgICAgICAgICAgICAgIGlmICgrYXdhaXQgaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKSA+IGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlciA9IGl0ZW1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWhlYWRlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBbXVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gK2F3YWl0IGhlYWRlci5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKVxuICAgICAgICAgICAgY29uc3QgZGVwdGggPSArYXdhaXQgaGVhZGVyLmdldEF0dHJpYnV0ZSgnYXJpYS1sZXZlbCcpICsgMVxuXG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHRoaXMudmlldy5pdGVtTGV2ZWwkJChkZXB0aClcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4SW5uZXIgPSArYXdhaXQgaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKVxuICAgICAgICAgICAgICAgIGlmIChpbmRleElubmVyID4gc3RhcnRJbmRleCAmJiBpbmRleElubmVyIDw9IHN0YXJ0SW5kZXggKyBjb3VudCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKGl0ZW0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgICAgICAgIGVsZW1lbnRzLm1hcChhc3luYyAoZWxlbWVudCkgPT4gKFxuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgICAgICAgICAgbmV3IFNjbUNoYW5nZSh0aGlzLmxvY2F0b3JNYXAsIGVsZW1lbnQgYXMgYW55LCB0aGlzKS53YWl0KClcbiAgICAgICAgICAgICkpXG4gICAgICAgIClcbiAgICB9XG5cbiAgICBhc3luYyBnZXRDaGFuZ2VDb3VudCAoc3RhZ2VkID0gZmFsc2UpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgICAgICBjb25zdCBsb2NhdG9yID0gc3RhZ2VkID8gdGhpcy5sb2NhdG9ycy5zdGFnZWRDaGFuZ2VzIDogdGhpcy5sb2NhdG9ycy5jaGFuZ2VzXG4gICAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCB0aGlzLnZpZXcuZWxlbS4kJChsb2NhdG9yKVxuICAgICAgICBjb25zdCBpbmRleCA9ICthd2FpdCB0aGlzLmVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWluZGV4JylcblxuICAgICAgICBmb3IgKGNvbnN0IHJvdyBvZiByb3dzKSB7XG4gICAgICAgICAgICBpZiAoK2F3YWl0IHJvdy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKSA+IGluZGV4KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCByb3dzWzBdLiQodGhpcy5sb2NhdG9ycy5jaGFuZ2VDb3VudClcbiAgICAgICAgICAgICAgICByZXR1cm4gK2F3YWl0IGNvdW50LmdldFRleHQoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwXG4gICAgfVxufVxuXG5pbnRlcmZhY2UgTXVsdGlNb3JlQWN0aW9uIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFNjbVZpZXdMb2NhdG9ycz4geyB9XG4vKipcbiAqIE11bHRpIE1vcmUgQWN0aW9uXG4gKlxuICogQGNhdGVnb3J5IFNpZGViYXJcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoU2NtVmlld0xvY2F0b3JzKVxuY2xhc3MgTXVsdGlNb3JlQWN0aW9uIGV4dGVuZHMgRWxlbWVudFdpdGhDb250ZXh0TWVudTx0eXBlb2YgU2NtVmlld0xvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdTY21WaWV3JyBhcyBjb25zdFxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIHB1YmxpYyBzY206IFNjbVByb3ZpZGVyXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzLCBsb2NhdG9ycy5TY21WaWV3Lm11bHRpTW9yZSBhcyBzdHJpbmcsIHNjbS5lbGVtKVxuICAgIH1cbn1cbiJdfQ==