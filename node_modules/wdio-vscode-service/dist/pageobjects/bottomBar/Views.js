var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import clipboard from 'clipboardy';
import { Key } from 'webdriverio';
import { Workbench, BottomBarPanel, ContentAssist } from '../../index.js';
import { TextView, ChannelView } from './AbstractViews.js';
import { ElementWithContextMenu, PageDecorator, sleep } from '../utils.js';
import { OutputView as OutputViewLocators, DebugConsoleView as DebugConsoleViewLocators, TerminalView as TerminalViewLocators } from '../../locators/1.73.0.js';
/**
 * Output view of the bottom panel
 *
 * ```ts
 * const bottomBar = workbench.getBottomBar()
 * const outputView = await bottomBar.openOutputView()
 * console.log(await outputView.getChannelNames())
 * // returns
 * // [
 * //   'Tasks',
 * //   'Extensions',
 * //   'Microsoft Authentication',
 * //   'Git',
 * //   'GitHub Authentication',
 * //   'Log (Window)',
 * //   'Log (Main)',
 * //   'Log (Extension Host)',
 * //   'Log (Settings Sync)',
 * //   'Log (Shared)'
 * // ]
 * ```
 *
 * @category BottomBar
 */
let OutputView = class OutputView extends TextView {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'OutputView';
        this.actionsLabel = locators.OutputView.actionsLabel;
        this.setParentElement(panel.elem);
    }
};
OutputView = __decorate([
    PageDecorator(OutputViewLocators)
], OutputView);
export { OutputView };
/**
 * Debug Console view on the bottom panel
 * Most functionality will only be available when a debug session is running
 *
 * @category BottomBar
 */
let DebugConsoleView = class DebugConsoleView extends ElementWithContextMenu {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'DebugConsoleView';
        this.setParentElement(panel.elem);
    }
    /**
     * Get all text from the debug console
     */
    async getText() {
        const menu = await this.openContextMenu();
        await menu.select('Copy All');
        const text = await clipboard.read();
        await clipboard.write('');
        return text;
    }
    /**
     * Clear the console of all text
     */
    async clearText() {
        const menu = await this.openContextMenu();
        await menu.select('Clear Console');
    }
    /**
     * Type an expression into the debug console text area
     * @param expression expression in form of a string
     */
    async setExpression(expression) {
        const textarea = await this.elem.$(this.locatorMap.BottomBarViews.textArea);
        await textarea.setValue(expression);
    }
    /**
     * Evaluate an expression:
     *  - if no argument is supplied, evaluate the current expression present in debug console text area
     *  - if a string argument is supplied, replace the current expression with the `expression` argument and evaluate
     *
     * @param expression expression to evaluate. To use existing contents of the debug console
     *                   text area instead, don't define this argument
     */
    async evaluateExpression(expression) {
        if (expression) {
            await this.setExpression(expression);
        }
        await browser.keys('Enter');
    }
    /**
     * Create a content assist page object
     * @returns promise resolving to ContentAssist object
     */
    async getContentAssist() {
        return new ContentAssist(this.locatorMap, this).wait();
    }
};
DebugConsoleView = __decorate([
    PageDecorator(DebugConsoleViewLocators)
], DebugConsoleView);
export { DebugConsoleView };
/**
 * Terminal view on the bottom panel
 *
 * @category BottomBar
 */
let TerminalView = class TerminalView extends ChannelView {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'TerminalView';
        this.actionsLabel = locators.OutputView.actionsLabel;
    }
    /**
     * Execute command in the internal terminal and wait for results
     * @param command text of the command
     * @param timeout optional maximum time to wait for completion in milliseconds, 0 for unlimited
     * @returns Promise resolving when the command is finished
     */
    async executeCommand(command, timeout = 0) {
        const input = await this.textArea$;
        try {
            await input.clearValue();
        }
        catch (err) {
            // try clearing, ignore if not available
        }
        await input.setValue(command);
        await browser.action('key').down(Key.Enter).up(Key.Enter).perform();
        let timer = 0;
        let style = await input.getCSSProperty('left');
        do {
            if (timeout > 0 && timer > timeout) {
                throw new Error(`Timeout of ${timeout}ms exceeded`);
            }
            await sleep(500);
            timer += 500;
            style = await input.getCSSProperty('left');
        } while (style.value === '0px');
    }
    /**
     * Get all text from the internal terminal
     * Beware, no formatting.
     * @returns Promise resolving to all terminal text
     */
    async getText() {
        const workbench = new Workbench(this.locatorMap);
        await workbench.executeCommand('terminal select all');
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(500);
        await workbench.executeCommand('terminal copy selection');
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(500);
        const text = clipboard.readSync();
        clipboard.writeSync('');
        return text;
    }
    /**
     * Destroy the currently open terminal
     * @returns Promise resolving when Kill Terminal button is pressed
     */
    async killTerminal() {
        await new Workbench(this.locatorMap)
            .executeCommand('terminal: kill the active terminal instance');
    }
    /**
     * Initiate new terminal creation
     * @returns Promise resolving when New Terminal button is pressed
     */
    async newTerminal() {
        await new Workbench(this.locatorMap)
            .executeCommand(this.locators.newCommand);
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length < 1) {
            await browser.waitUntil(async () => {
                const list = await this.tabList$$;
                return list.length > 0;
            }, { timeout: 5000 });
        }
    }
    async getCurrentChannel() {
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length > 0) {
            return super.getCurrentChannel();
        }
        const singleTerm = await this.panel.elem.$$(this.locators.singleTab);
        if (singleTerm.length > 0) {
            return singleTerm[0].getText();
        }
        const list = await this.tabList$;
        const row = await list.$(this.locators.selectedRow);
        const label = (await row.getAttribute('aria-label')).split(' ');
        return `${label[1]}: ${label[2]}`;
    }
    async selectChannel(name) {
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length > 0) {
            return super.selectChannel(name);
        }
        const singleTerm = await this.panel.elem.$$(this.locators.singleTab);
        if (singleTerm.length > 0) {
            return undefined;
        }
        const matches = name.match(/.*(\d+).?\s.*/);
        if (matches === null || !matches[1]) {
            throw new Error(`Channel ${name} not found`);
        }
        const channelNumber = matches[1];
        const list = await this.tabList$;
        const rows = await list.$$(this.locators.row);
        for (const row of rows) {
            const label = await row.getAttribute('aria-label');
            if (label.includes(channelNumber)) {
                await row.click();
                return undefined;
            }
        }
        throw new Error(`Channel ${name} not found`);
    }
};
TerminalView = __decorate([
    PageDecorator(TerminalViewLocators)
], TerminalView);
export { TerminalView };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvYm90dG9tQmFyL1ZpZXdzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBRWpDLE9BQU8sRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ3pFLE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDMUQsT0FBTyxFQUNILHNCQUFzQixFQUFFLGFBQWEsRUFDckMsS0FBSyxFQUNSLE1BQU0sYUFBYSxDQUFBO0FBQ3BCLE9BQU8sRUFDSCxVQUFVLElBQUksa0JBQWtCLEVBQ2hDLGdCQUFnQixJQUFJLHdCQUF3QixFQUM1QyxZQUFZLElBQUksb0JBQW9CLEVBQ3ZDLE1BQU0sMEJBQTBCLENBQUE7QUFHakM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBRUksSUFBTSxVQUFVLEdBQWhCLE1BQU0sVUFBVyxTQUFRLFFBQW1DO0lBTS9ELFlBQ0ksUUFBMEIsRUFDbkIsUUFBUSxJQUFJLGNBQWMsQ0FBQyxRQUFRLENBQUM7UUFFM0MsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRlIsVUFBSyxHQUFMLEtBQUssQ0FBK0I7UUFQL0M7O1dBRUc7UUFDSSxlQUFVLEdBQUcsWUFBcUIsQ0FBQTtRQU9yQyxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsWUFBc0IsQ0FBQTtRQUM5RCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3JDLENBQUM7Q0FDSixDQUFBO0FBZFksVUFBVTtJQUR0QixhQUFhLENBQUMsa0JBQWtCLENBQUM7R0FDckIsVUFBVSxDQWN0QjtTQWRZLFVBQVU7QUFpQnZCOzs7OztHQUtHO0FBRUksSUFBTSxnQkFBZ0IsR0FBdEIsTUFBTSxnQkFBaUIsU0FBUSxzQkFBdUQ7SUFNekYsWUFDSSxRQUEwQixFQUNuQixRQUF3QixJQUFJLGNBQWMsQ0FBQyxRQUFRLENBQUM7UUFFM0QsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRlIsVUFBSyxHQUFMLEtBQUssQ0FBK0M7UUFQL0Q7O1dBRUc7UUFDSSxlQUFVLEdBQUcsa0JBQTJCLENBQUE7UUFPM0MsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNyQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsT0FBTztRQUNULE1BQU0sSUFBSSxHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFBO1FBQ3pDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUM3QixNQUFNLElBQUksR0FBRyxNQUFNLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtRQUNuQyxNQUFNLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDekIsT0FBTyxJQUFJLENBQUE7SUFDZixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsU0FBUztRQUNYLE1BQU0sSUFBSSxHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFBO1FBQ3pDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQTtJQUN0QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLGFBQWEsQ0FBRSxVQUFrQjtRQUNuQyxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLFFBQWtCLENBQUMsQ0FBQTtRQUNyRixNQUFNLFFBQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUE7SUFDdkMsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSCxLQUFLLENBQUMsa0JBQWtCLENBQUUsVUFBbUI7UUFDekMsSUFBSSxVQUFVLEVBQUU7WUFDWixNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUE7U0FDdkM7UUFDRCxNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDL0IsQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxnQkFBZ0I7UUFDbEIsT0FBTyxJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO0lBQzFELENBQUM7Q0FDSixDQUFBO0FBaEVZLGdCQUFnQjtJQUQ1QixhQUFhLENBQUMsd0JBQXdCLENBQUM7R0FDM0IsZ0JBQWdCLENBZ0U1QjtTQWhFWSxnQkFBZ0I7QUFtRTdCOzs7O0dBSUc7QUFFSSxJQUFNLFlBQVksR0FBbEIsTUFBTSxZQUFhLFNBQVEsV0FBd0M7SUFNdEUsWUFDSSxRQUEwQixFQUNuQixRQUFRLElBQUksY0FBYyxDQUFDLFFBQVEsQ0FBQztRQUUzQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUE7UUFGUixVQUFLLEdBQUwsS0FBSyxDQUErQjtRQVAvQzs7V0FFRztRQUNJLGVBQVUsR0FBRyxjQUF1QixDQUFBO1FBT3ZDLElBQUksQ0FBQyxZQUFZLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxZQUFzQixDQUFBO0lBQ2xFLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILEtBQUssQ0FBQyxjQUFjLENBQUUsT0FBZSxFQUFFLE9BQU8sR0FBRyxDQUFDO1FBQzlDLE1BQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxDQUFDLFNBQVMsQ0FBQTtRQUVsQyxJQUFJO1lBQ0EsTUFBTSxLQUFLLENBQUMsVUFBVSxFQUFFLENBQUE7U0FDM0I7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNWLHdDQUF3QztTQUMzQztRQUNELE1BQU0sS0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUM3QixNQUFNLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFBO1FBRW5FLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQTtRQUNiLElBQUksS0FBSyxHQUFHLE1BQU0sS0FBSyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUM5QyxHQUFHO1lBQ0MsSUFBSSxPQUFPLEdBQUcsQ0FBQyxJQUFJLEtBQUssR0FBRyxPQUFPLEVBQUU7Z0JBQ2hDLE1BQU0sSUFBSSxLQUFLLENBQUMsY0FBYyxPQUFPLGFBQWEsQ0FBQyxDQUFBO2FBQ3REO1lBQ0QsTUFBTSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDaEIsS0FBSyxJQUFJLEdBQUcsQ0FBQTtZQUNaLEtBQUssR0FBRyxNQUFNLEtBQUssQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUE7U0FDN0MsUUFBUSxLQUFLLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBQztJQUNuQyxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILEtBQUssQ0FBQyxPQUFPO1FBQ1QsTUFBTSxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQ2hELE1BQU0sU0FBUyxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO1FBQ3JELHlDQUF5QztRQUN6QyxNQUFNLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDeEIsTUFBTSxTQUFTLENBQUMsY0FBYyxDQUFDLHlCQUF5QixDQUFDLENBQUE7UUFDekQseUNBQXlDO1FBQ3pDLE1BQU0sT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN4QixNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDakMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUN2QixPQUFPLElBQUksQ0FBQTtJQUNmLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsWUFBWTtRQUNkLE1BQU0sSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQzthQUMvQixjQUFjLENBQUMsNkNBQTZDLENBQUMsQ0FBQTtJQUN0RSxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLFdBQVc7UUFDYixNQUFNLElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7YUFDL0IsY0FBYyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDN0MsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsWUFBc0IsQ0FBQyxDQUFBO1FBQzdGLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEIsTUFBTSxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO2dCQUMvQixNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUE7Z0JBQ2pDLE9BQU8sSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7WUFDMUIsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7U0FDeEI7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLGlCQUFpQjtRQUNuQixNQUFNLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxZQUFzQixDQUFDLENBQUE7UUFDN0YsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNsQixPQUFPLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFBO1NBQ25DO1FBQ0QsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNwRSxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3ZCLE9BQU8sVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFBO1NBQ2pDO1FBQ0QsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFBO1FBQ2hDLE1BQU0sR0FBRyxHQUFHLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQ25ELE1BQU0sS0FBSyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBRS9ELE9BQU8sR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUE7SUFDckMsQ0FBQztJQUVELEtBQUssQ0FBQyxhQUFhLENBQUUsSUFBWTtRQUM3QixNQUFNLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxZQUFzQixDQUFDLENBQUE7UUFDN0YsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNsQixPQUFPLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUE7U0FDbkM7UUFDRCxNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ3BFLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdkIsT0FBTyxTQUFTLENBQUE7U0FDbkI7UUFFRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFBO1FBQzNDLElBQUksT0FBTyxLQUFLLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNqQyxNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsSUFBSSxZQUFZLENBQUMsQ0FBQTtTQUMvQztRQUNELE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUVoQyxNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUE7UUFDaEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFN0MsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUU7WUFDcEIsTUFBTSxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBQ2xELElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDL0IsTUFBTSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUE7Z0JBQ2pCLE9BQU8sU0FBUyxDQUFBO2FBQ25CO1NBQ0o7UUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsSUFBSSxZQUFZLENBQUMsQ0FBQTtJQUNoRCxDQUFDO0NBQ0osQ0FBQTtBQWxJWSxZQUFZO0lBRHhCLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQztHQUN2QixZQUFZLENBa0l4QjtTQWxJWSxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNsaXBib2FyZCBmcm9tICdjbGlwYm9hcmR5J1xuaW1wb3J0IHsgS2V5IH0gZnJvbSAnd2ViZHJpdmVyaW8nXG5cbmltcG9ydCB7IFdvcmtiZW5jaCwgQm90dG9tQmFyUGFuZWwsIENvbnRlbnRBc3Npc3QgfSBmcm9tICcuLi8uLi9pbmRleC5qcydcbmltcG9ydCB7IFRleHRWaWV3LCBDaGFubmVsVmlldyB9IGZyb20gJy4vQWJzdHJhY3RWaWV3cy5qcydcbmltcG9ydCB7XG4gICAgRWxlbWVudFdpdGhDb250ZXh0TWVudSwgUGFnZURlY29yYXRvciwgSVBhZ2VEZWNvcmF0b3IsIFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgc2xlZXBcbn0gZnJvbSAnLi4vdXRpbHMuanMnXG5pbXBvcnQge1xuICAgIE91dHB1dFZpZXcgYXMgT3V0cHV0Vmlld0xvY2F0b3JzLFxuICAgIERlYnVnQ29uc29sZVZpZXcgYXMgRGVidWdDb25zb2xlVmlld0xvY2F0b3JzLFxuICAgIFRlcm1pbmFsVmlldyBhcyBUZXJtaW5hbFZpZXdMb2NhdG9yc1xufSBmcm9tICcuLi8uLi9sb2NhdG9ycy8xLjczLjAuanMnXG5cbmV4cG9ydCBpbnRlcmZhY2UgT3V0cHV0VmlldyBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBPdXRwdXRWaWV3TG9jYXRvcnM+IHt9XG4vKipcbiAqIE91dHB1dCB2aWV3IG9mIHRoZSBib3R0b20gcGFuZWxcbiAqXG4gKiBgYGB0c1xuICogY29uc3QgYm90dG9tQmFyID0gd29ya2JlbmNoLmdldEJvdHRvbUJhcigpXG4gKiBjb25zdCBvdXRwdXRWaWV3ID0gYXdhaXQgYm90dG9tQmFyLm9wZW5PdXRwdXRWaWV3KClcbiAqIGNvbnNvbGUubG9nKGF3YWl0IG91dHB1dFZpZXcuZ2V0Q2hhbm5lbE5hbWVzKCkpXG4gKiAvLyByZXR1cm5zXG4gKiAvLyBbXG4gKiAvLyAgICdUYXNrcycsXG4gKiAvLyAgICdFeHRlbnNpb25zJyxcbiAqIC8vICAgJ01pY3Jvc29mdCBBdXRoZW50aWNhdGlvbicsXG4gKiAvLyAgICdHaXQnLFxuICogLy8gICAnR2l0SHViIEF1dGhlbnRpY2F0aW9uJyxcbiAqIC8vICAgJ0xvZyAoV2luZG93KScsXG4gKiAvLyAgICdMb2cgKE1haW4pJyxcbiAqIC8vICAgJ0xvZyAoRXh0ZW5zaW9uIEhvc3QpJyxcbiAqIC8vICAgJ0xvZyAoU2V0dGluZ3MgU3luYyknLFxuICogLy8gICAnTG9nIChTaGFyZWQpJ1xuICogLy8gXVxuICogYGBgXG4gKlxuICogQGNhdGVnb3J5IEJvdHRvbUJhclxuICovXG5AUGFnZURlY29yYXRvcihPdXRwdXRWaWV3TG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgT3V0cHV0VmlldyBleHRlbmRzIFRleHRWaWV3PHR5cGVvZiBPdXRwdXRWaWV3TG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ091dHB1dFZpZXcnIGFzIGNvbnN0XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBwdWJsaWMgcGFuZWwgPSBuZXcgQm90dG9tQmFyUGFuZWwobG9jYXRvcnMpXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzKVxuICAgICAgICB0aGlzLmFjdGlvbnNMYWJlbCA9IGxvY2F0b3JzLk91dHB1dFZpZXcuYWN0aW9uc0xhYmVsIGFzIHN0cmluZ1xuICAgICAgICB0aGlzLnNldFBhcmVudEVsZW1lbnQocGFuZWwuZWxlbSlcbiAgICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVidWdDb25zb2xlVmlldyBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBEZWJ1Z0NvbnNvbGVWaWV3TG9jYXRvcnM+IHt9XG4vKipcbiAqIERlYnVnIENvbnNvbGUgdmlldyBvbiB0aGUgYm90dG9tIHBhbmVsXG4gKiBNb3N0IGZ1bmN0aW9uYWxpdHkgd2lsbCBvbmx5IGJlIGF2YWlsYWJsZSB3aGVuIGEgZGVidWcgc2Vzc2lvbiBpcyBydW5uaW5nXG4gKlxuICogQGNhdGVnb3J5IEJvdHRvbUJhclxuICovXG5AUGFnZURlY29yYXRvcihEZWJ1Z0NvbnNvbGVWaWV3TG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgRGVidWdDb25zb2xlVmlldyBleHRlbmRzIEVsZW1lbnRXaXRoQ29udGV4dE1lbnU8dHlwZW9mIERlYnVnQ29uc29sZVZpZXdMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnRGVidWdDb25zb2xlVmlldycgYXMgY29uc3RcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIHB1YmxpYyBwYW5lbDogQm90dG9tQmFyUGFuZWwgPSBuZXcgQm90dG9tQmFyUGFuZWwobG9jYXRvcnMpXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzKVxuICAgICAgICB0aGlzLnNldFBhcmVudEVsZW1lbnQocGFuZWwuZWxlbSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRleHQgZnJvbSB0aGUgZGVidWcgY29uc29sZVxuICAgICAqL1xuICAgIGFzeW5jIGdldFRleHQgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IG1lbnUgPSBhd2FpdCB0aGlzLm9wZW5Db250ZXh0TWVudSgpXG4gICAgICAgIGF3YWl0IG1lbnUuc2VsZWN0KCdDb3B5IEFsbCcpXG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCBjbGlwYm9hcmQucmVhZCgpXG4gICAgICAgIGF3YWl0IGNsaXBib2FyZC53cml0ZSgnJylcbiAgICAgICAgcmV0dXJuIHRleHRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGVhciB0aGUgY29uc29sZSBvZiBhbGwgdGV4dFxuICAgICAqL1xuICAgIGFzeW5jIGNsZWFyVGV4dCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IG1lbnUgPSBhd2FpdCB0aGlzLm9wZW5Db250ZXh0TWVudSgpXG4gICAgICAgIGF3YWl0IG1lbnUuc2VsZWN0KCdDbGVhciBDb25zb2xlJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUeXBlIGFuIGV4cHJlc3Npb24gaW50byB0aGUgZGVidWcgY29uc29sZSB0ZXh0IGFyZWFcbiAgICAgKiBAcGFyYW0gZXhwcmVzc2lvbiBleHByZXNzaW9uIGluIGZvcm0gb2YgYSBzdHJpbmdcbiAgICAgKi9cbiAgICBhc3luYyBzZXRFeHByZXNzaW9uIChleHByZXNzaW9uOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgdGV4dGFyZWEgPSBhd2FpdCB0aGlzLmVsZW0uJCh0aGlzLmxvY2F0b3JNYXAuQm90dG9tQmFyVmlld3MudGV4dEFyZWEgYXMgc3RyaW5nKVxuICAgICAgICBhd2FpdCB0ZXh0YXJlYS5zZXRWYWx1ZShleHByZXNzaW9uKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV2YWx1YXRlIGFuIGV4cHJlc3Npb246XG4gICAgICogIC0gaWYgbm8gYXJndW1lbnQgaXMgc3VwcGxpZWQsIGV2YWx1YXRlIHRoZSBjdXJyZW50IGV4cHJlc3Npb24gcHJlc2VudCBpbiBkZWJ1ZyBjb25zb2xlIHRleHQgYXJlYVxuICAgICAqICAtIGlmIGEgc3RyaW5nIGFyZ3VtZW50IGlzIHN1cHBsaWVkLCByZXBsYWNlIHRoZSBjdXJyZW50IGV4cHJlc3Npb24gd2l0aCB0aGUgYGV4cHJlc3Npb25gIGFyZ3VtZW50IGFuZCBldmFsdWF0ZVxuICAgICAqXG4gICAgICogQHBhcmFtIGV4cHJlc3Npb24gZXhwcmVzc2lvbiB0byBldmFsdWF0ZS4gVG8gdXNlIGV4aXN0aW5nIGNvbnRlbnRzIG9mIHRoZSBkZWJ1ZyBjb25zb2xlXG4gICAgICogICAgICAgICAgICAgICAgICAgdGV4dCBhcmVhIGluc3RlYWQsIGRvbid0IGRlZmluZSB0aGlzIGFyZ3VtZW50XG4gICAgICovXG4gICAgYXN5bmMgZXZhbHVhdGVFeHByZXNzaW9uIChleHByZXNzaW9uPzogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmIChleHByZXNzaW9uKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNldEV4cHJlc3Npb24oZXhwcmVzc2lvbilcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBicm93c2VyLmtleXMoJ0VudGVyJylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBjb250ZW50IGFzc2lzdCBwYWdlIG9iamVjdFxuICAgICAqIEByZXR1cm5zIHByb21pc2UgcmVzb2x2aW5nIHRvIENvbnRlbnRBc3Npc3Qgb2JqZWN0XG4gICAgICovXG4gICAgYXN5bmMgZ2V0Q29udGVudEFzc2lzdCAoKTogUHJvbWlzZTxDb250ZW50QXNzaXN0PiB7XG4gICAgICAgIHJldHVybiBuZXcgQ29udGVudEFzc2lzdCh0aGlzLmxvY2F0b3JNYXAsIHRoaXMpLndhaXQoKVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBUZXJtaW5hbFZpZXcgZXh0ZW5kcyBJUGFnZURlY29yYXRvcjx0eXBlb2YgVGVybWluYWxWaWV3TG9jYXRvcnM+IHt9XG4vKipcbiAqIFRlcm1pbmFsIHZpZXcgb24gdGhlIGJvdHRvbSBwYW5lbFxuICpcbiAqIEBjYXRlZ29yeSBCb3R0b21CYXJcbiAqL1xuQFBhZ2VEZWNvcmF0b3IoVGVybWluYWxWaWV3TG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgVGVybWluYWxWaWV3IGV4dGVuZHMgQ2hhbm5lbFZpZXc8dHlwZW9mIFRlcm1pbmFsVmlld0xvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdUZXJtaW5hbFZpZXcnIGFzIGNvbnN0XG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBwdWJsaWMgcGFuZWwgPSBuZXcgQm90dG9tQmFyUGFuZWwobG9jYXRvcnMpXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzKVxuICAgICAgICB0aGlzLmFjdGlvbnNMYWJlbCA9IGxvY2F0b3JzLk91dHB1dFZpZXcuYWN0aW9uc0xhYmVsIGFzIHN0cmluZ1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgY29tbWFuZCBpbiB0aGUgaW50ZXJuYWwgdGVybWluYWwgYW5kIHdhaXQgZm9yIHJlc3VsdHNcbiAgICAgKiBAcGFyYW0gY29tbWFuZCB0ZXh0IG9mIHRoZSBjb21tYW5kXG4gICAgICogQHBhcmFtIHRpbWVvdXQgb3B0aW9uYWwgbWF4aW11bSB0aW1lIHRvIHdhaXQgZm9yIGNvbXBsZXRpb24gaW4gbWlsbGlzZWNvbmRzLCAwIGZvciB1bmxpbWl0ZWRcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIHRoZSBjb21tYW5kIGlzIGZpbmlzaGVkXG4gICAgICovXG4gICAgYXN5bmMgZXhlY3V0ZUNvbW1hbmQgKGNvbW1hbmQ6IHN0cmluZywgdGltZW91dCA9IDApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgaW5wdXQgPSBhd2FpdCB0aGlzLnRleHRBcmVhJFxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBpbnB1dC5jbGVhclZhbHVlKClcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAvLyB0cnkgY2xlYXJpbmcsIGlnbm9yZSBpZiBub3QgYXZhaWxhYmxlXG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgaW5wdXQuc2V0VmFsdWUoY29tbWFuZClcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5hY3Rpb24oJ2tleScpLmRvd24oS2V5LkVudGVyKS51cChLZXkuRW50ZXIpLnBlcmZvcm0oKVxuXG4gICAgICAgIGxldCB0aW1lciA9IDBcbiAgICAgICAgbGV0IHN0eWxlID0gYXdhaXQgaW5wdXQuZ2V0Q1NTUHJvcGVydHkoJ2xlZnQnKVxuICAgICAgICBkbyB7XG4gICAgICAgICAgICBpZiAodGltZW91dCA+IDAgJiYgdGltZXIgPiB0aW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaW1lb3V0IG9mICR7dGltZW91dH1tcyBleGNlZWRlZGApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCBzbGVlcCg1MDApXG4gICAgICAgICAgICB0aW1lciArPSA1MDBcbiAgICAgICAgICAgIHN0eWxlID0gYXdhaXQgaW5wdXQuZ2V0Q1NTUHJvcGVydHkoJ2xlZnQnKVxuICAgICAgICB9IHdoaWxlIChzdHlsZS52YWx1ZSA9PT0gJzBweCcpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFsbCB0ZXh0IGZyb20gdGhlIGludGVybmFsIHRlcm1pbmFsXG4gICAgICogQmV3YXJlLCBubyBmb3JtYXR0aW5nLlxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGFsbCB0ZXJtaW5hbCB0ZXh0XG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGV4dCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3Qgd29ya2JlbmNoID0gbmV3IFdvcmtiZW5jaCh0aGlzLmxvY2F0b3JNYXApXG4gICAgICAgIGF3YWl0IHdvcmtiZW5jaC5leGVjdXRlQ29tbWFuZCgndGVybWluYWwgc2VsZWN0IGFsbCcpXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB3ZGlvL25vLXBhdXNlXG4gICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoNTAwKVxuICAgICAgICBhd2FpdCB3b3JrYmVuY2guZXhlY3V0ZUNvbW1hbmQoJ3Rlcm1pbmFsIGNvcHkgc2VsZWN0aW9uJylcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHdkaW8vbm8tcGF1c2VcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5wYXVzZSg1MDApXG4gICAgICAgIGNvbnN0IHRleHQgPSBjbGlwYm9hcmQucmVhZFN5bmMoKVxuICAgICAgICBjbGlwYm9hcmQud3JpdGVTeW5jKCcnKVxuICAgICAgICByZXR1cm4gdGV4dFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlc3Ryb3kgdGhlIGN1cnJlbnRseSBvcGVuIHRlcm1pbmFsXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiBLaWxsIFRlcm1pbmFsIGJ1dHRvbiBpcyBwcmVzc2VkXG4gICAgICovXG4gICAgYXN5bmMga2lsbFRlcm1pbmFsICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgbmV3IFdvcmtiZW5jaCh0aGlzLmxvY2F0b3JNYXApXG4gICAgICAgICAgICAuZXhlY3V0ZUNvbW1hbmQoJ3Rlcm1pbmFsOiBraWxsIHRoZSBhY3RpdmUgdGVybWluYWwgaW5zdGFuY2UnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYXRlIG5ldyB0ZXJtaW5hbCBjcmVhdGlvblxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gTmV3IFRlcm1pbmFsIGJ1dHRvbiBpcyBwcmVzc2VkXG4gICAgICovXG4gICAgYXN5bmMgbmV3VGVybWluYWwgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBuZXcgV29ya2JlbmNoKHRoaXMubG9jYXRvck1hcClcbiAgICAgICAgICAgIC5leGVjdXRlQ29tbWFuZCh0aGlzLmxvY2F0b3JzLm5ld0NvbW1hbmQpXG4gICAgICAgIGNvbnN0IGNvbWJvID0gYXdhaXQgdGhpcy5wYW5lbC5lbGVtLiQkKHRoaXMubG9jYXRvck1hcC5Cb3R0b21CYXJWaWV3cy5jaGFubmVsQ29tYm8gYXMgc3RyaW5nKVxuICAgICAgICBpZiAoY29tYm8ubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci53YWl0VW50aWwoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpc3QgPSBhd2FpdCB0aGlzLnRhYkxpc3QkJFxuICAgICAgICAgICAgICAgIHJldHVybiBsaXN0Lmxlbmd0aCA+IDBcbiAgICAgICAgICAgIH0sIHsgdGltZW91dDogNTAwMCB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0Q3VycmVudENoYW5uZWwgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIGNvbnN0IGNvbWJvID0gYXdhaXQgdGhpcy5wYW5lbC5lbGVtLiQkKHRoaXMubG9jYXRvck1hcC5Cb3R0b21CYXJWaWV3cy5jaGFubmVsQ29tYm8gYXMgc3RyaW5nKVxuICAgICAgICBpZiAoY29tYm8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldEN1cnJlbnRDaGFubmVsKClcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaW5nbGVUZXJtID0gYXdhaXQgdGhpcy5wYW5lbC5lbGVtLiQkKHRoaXMubG9jYXRvcnMuc2luZ2xlVGFiKVxuICAgICAgICBpZiAoc2luZ2xlVGVybS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc2luZ2xlVGVybVswXS5nZXRUZXh0KClcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsaXN0ID0gYXdhaXQgdGhpcy50YWJMaXN0JFxuICAgICAgICBjb25zdCByb3cgPSBhd2FpdCBsaXN0LiQodGhpcy5sb2NhdG9ycy5zZWxlY3RlZFJvdylcbiAgICAgICAgY29uc3QgbGFiZWwgPSAoYXdhaXQgcm93LmdldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpKS5zcGxpdCgnICcpXG5cbiAgICAgICAgcmV0dXJuIGAke2xhYmVsWzFdfTogJHtsYWJlbFsyXX1gXG4gICAgfVxuXG4gICAgYXN5bmMgc2VsZWN0Q2hhbm5lbCAobmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IGNvbWJvID0gYXdhaXQgdGhpcy5wYW5lbC5lbGVtLiQkKHRoaXMubG9jYXRvck1hcC5Cb3R0b21CYXJWaWV3cy5jaGFubmVsQ29tYm8gYXMgc3RyaW5nKVxuICAgICAgICBpZiAoY29tYm8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLnNlbGVjdENoYW5uZWwobmFtZSlcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaW5nbGVUZXJtID0gYXdhaXQgdGhpcy5wYW5lbC5lbGVtLiQkKHRoaXMubG9jYXRvcnMuc2luZ2xlVGFiKVxuICAgICAgICBpZiAoc2luZ2xlVGVybS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYXRjaGVzID0gbmFtZS5tYXRjaCgvLiooXFxkKykuP1xccy4qLylcbiAgICAgICAgaWYgKG1hdGNoZXMgPT09IG51bGwgfHwgIW1hdGNoZXNbMV0pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2hhbm5lbCAke25hbWV9IG5vdCBmb3VuZGApXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhbm5lbE51bWJlciA9IG1hdGNoZXNbMV1cblxuICAgICAgICBjb25zdCBsaXN0ID0gYXdhaXQgdGhpcy50YWJMaXN0JFxuICAgICAgICBjb25zdCByb3dzID0gYXdhaXQgbGlzdC4kJCh0aGlzLmxvY2F0b3JzLnJvdylcblxuICAgICAgICBmb3IgKGNvbnN0IHJvdyBvZiByb3dzKSB7XG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IGF3YWl0IHJvdy5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKVxuICAgICAgICAgICAgaWYgKGxhYmVsLmluY2x1ZGVzKGNoYW5uZWxOdW1iZXIpKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgcm93LmNsaWNrKClcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDaGFubmVsICR7bmFtZX0gbm90IGZvdW5kYClcbiAgICB9XG59XG4iXX0=